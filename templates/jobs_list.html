{% extends "layout.html" %}{% block content %}<h1>Zakázky</h1>

<!-- GLOBAL SEARCH (tables/lists) -->
<div class="card card-dark" style="margin-bottom:10px">
  <div class="card-c">
    <input id="__globalSearch" class="inp" type="search" placeholder="Hledat…">
  </div>
</div>
<script>
(function(){
  const input=document.getElementById('__globalSearch');
  if(!input) return;
  function getSets(){
    const sets=[];
    document.querySelectorAll('table').forEach(t=>{
      const b=t.tBodies&&t.tBodies[0]||t.querySelector('tbody');
      if(b){ const rows=Array.from(b.querySelectorAll('tr')); if(rows.length) sets.push(rows); }
    });
    document.querySelectorAll('.card-list,.jobs-list,.employees-list').forEach(list=>{
      sets.push(Array.from(list.children));
    });
    return sets;
  }
  function apply(){
    const q=(input.value||'').toLowerCase().trim();
    const sets=getSets();
    sets.forEach(rows=>rows.forEach(row=>{
      const text=(row.getAttribute('data-search')||row.innerText||'').toLowerCase();
      row.style.display=!q||text.includes(q)?'':'none';
    }));
  }
  ['input','keyup','search','change'].forEach(ev=>input.addEventListener(ev,apply));
  new MutationObserver(apply).observe(document.body,{childList:true,subtree:true});
  apply();
})();
</script>
<!-- /GLOBAL SEARCH (tables/lists) -->
<form action="/jobs/new" method="get" style="margin-bottom:12px"><button class="btn">Nová zakázka</button></form><table class="table"><tr><th>ID</th><th>Název</th><th>Klient</th><th>Stav</th><th>Vlastník</th><th></th></tr>{% for j in rows %}<tr><td>{{j.id}}</td><td>{{j.name}}</td><td>{{j.client or ""}}</td><td>{{j.status}}</td><td>{{j.owner_email}}</td><td><a class="btn ghost" href="/jobs/{{j.id}}/edit">Upravit</a><form method="post" action="/jobs/{{j.id}}/delete" style="display:inline" onsubmit="return confirm('Smazat?')"><button class="btn">Smazat</button></form></td></tr>{% endfor %}</table>{% endblock %}