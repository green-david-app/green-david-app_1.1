<div class="my-tasks-widget">
    {% set task_list = tasks if tasks else (context.tasks if context and context.tasks else []) %}
    {% if task_list and task_list|length > 0 %}
        <div class="tasks-list">
            {% for task in task_list[:5] %}
            <div class="task-item {% if task.status == 'done' %}done{% endif %}">
                <div class="task-checkbox">
                    <input type="checkbox" {% if task.status == 'done' %}checked{% endif %} 
                           onchange="toggleTask({{ task.id }}, this.checked)">
                </div>
                <div class="task-content">
                    <h4>{{ task.title }}</h4>
                    {% if task.job_name %}
                    <p class="task-job">{{ task.job_name }}</p>
                    {% endif %}
                    {% if task.due_date %}
                    <p class="task-due">{{ task.due_date }}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% if task_list|length > 5 %}
        <a href="/tasks.html" class="view-all">Zobrazit vše ({{ task_list|length }})</a>
        {% endif %}
    {% else %}
        <p class="empty-state">Žádné úkoly dnes</p>
    {% endif %}
</div>

<script>
async function toggleTask(taskId, completed) {
    try {
        const response = await fetch(`/api/tasks/${taskId}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status: completed ? 'done' : 'open' })
        });
        
        if (response.ok) {
            location.reload();
        }
    } catch (error) {
        console.error('Error:', error);
    }
}
</script>
