{% extends "layout.html" %}{% block content %}<h1>Uživatelé</h1>

<div class="card card-dark gd-global-search" style="margin-bottom:10px">
  <div class="card-c">
    <input id="__globalSearch" class="inp" type="search" placeholder="Hledat…" style="width:100%">
  </div>
</div>
<form method="post" action="/admin/users/new" class="form" style="max-width:520px;margin-bottom:16px"><h3>Vytvořit uživatele</h3><label>Email <input name="email" type="email" required></label><label>Jméno <input name="name"></label><label>Heslo <input name="password" type="password" required minlength="8"></label><label>Role <select name="role"><option value="user">user</option><option value="admin">admin</option></select></label><button class="btn">Vytvořit uživatele</button></form><table class="table"><tr><th>ID</th><th>Email</th><th>Role</th><th>Schválen</th><th>Aktivní</th><th>Akce</th></tr>{% for u in users %}<tr><td>{{u.id}}</td><td>{{u.email}}</td><td>{{u.role}}</td><td>{{u.approved}}</td><td>{{u.active}}</td><td><form method="post" style="display:inline"><input type="hidden" name="id" value="{{u.id}}"><button class="btn" name="action" value="approve">Schválit</button><button class="btn ghost" name="action" value="disable">Blokovat</button><button class="btn" name="action" value="enable">Povolit</button><button class="btn" name="action" value="make_admin" onclick="return confirm('Udělít admina?')">Admin</button></form></td></tr>{% endfor %}</table>{% endblock %}
<script>/*common filter*/
(function(){
  const input = document.getElementById('__globalSearch');
  if(!input) return;
  function getSets(){
    const sets = [];
    document.querySelectorAll('table').forEach(t=>{
      const b = t.tBodies && t.tBodies[0] || t.querySelector('tbody');
      if(b){ const rows = Array.from(b.querySelectorAll('tr')); if(rows.length) sets.push(rows); }
    });
    document.querySelectorAll('.card-list,.jobs-list,.employees-list').forEach(list=>{
      sets.push(Array.from(list.children));
    });
    return sets;
  }
  function apply(){
    const q = (input.value||'').toLowerCase().trim();
    const sets = getSets();
    sets.forEach(rows=>rows.forEach(tr=>{
      const text = (tr.getAttribute('data-search') || tr.innerText || '').toLowerCase();
      tr.style.display = !q || text.includes(q) ? '' : 'none';
    }));
  }
  input.addEventListener('input', apply); apply();
})();
</script>
