{% extends "layout.html" %}
{% block content %}
<div class="page-pad">
  <div class="tabs sticky">
    <a class="tab" href="/calendar.html">Kalendář</a>
    <a class="tab" href="/timesheets.html">Výkazy hodin</a>
    <a class="tab" href="/?tab=jobs">Zakázky</a>
    <a class="tab" href="/?tab=tasks">Úkoly</a>
    <a class="tab" href="/zamestnanci">Zaměstnanci</a>
    <a class="tab active" href="/brigadnici.html">Brigádníci</a>
    <a class="tab" href="/?tab=warehouse">Sklad</a>
    <a class="tab" href="/?tab=users">Uživatelé</a>
  </div>

  <div class="card card-dark">
    <div class="card-h"><strong>Nový brigádník</strong></div>
    <div class="card-c">
      <div class="row">
        <input id="newName" type="text" placeholder="Jméno" class="inp"/>
        <button id="btnAdd" class="btn btn-primary">Přidat</button>
      </div>
    </div>
  </div>

  <div class="card card-dark">
    <div class="card-h"><strong>Seznam</strong></div>
    <div class="card-c">
      <table class="tbl">
        <thead><tr><th>ID</th><th>Jméno</th><th>Role</th></tr></thead>
        <tbody id="listBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
(async function(){
  const listBody = document.getElementById('listBody');
  const newName = document.getElementById('newName');
  const btnAdd = document.getElementById('btnAdd');

  async function fetchJSON(url){ const r = await fetch(url); if(!r.ok) throw new Error(await r.text()); return r.json(); }
  async function apiJSON(url, options){
    const r = await fetch(url, Object.assign({headers:{'Content-Type':'application/json'}}, options||{}));
    if(!r.ok) throw new Error(await r.text());
    return r.json();
  }

  btnAdd.addEventListener('click', async ()=>{
    const name = newName.value.trim();
    if(!name) return;
    await apiJSON('/api/employees', { method:'POST', body: JSON.stringify({ name, role: 'brigádník' }) });
    newName.value=''; await render();
  });

  async function render(){
    listBody.innerHTML = '<tr><td colspan="3" class="muted">Načítám…</td></tr>';
    const data = await fetchJSON('/api/employees');
    const rows = (data.employees || []).filter(e => String(e.role||'').toLowerCase()==='brigádník');
    if(rows.length===0){
      listBody.innerHTML = '<tr><td colspan="3" class="muted">Žádní brigádníci</td></tr>';
      return;
    }
    listBody.innerHTML = '';
    for(const e of rows){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${e.id}</td><td>${e.name}</td><td>${e.role||'brigádník'}</td>`;
      listBody.appendChild(tr);
    }
  }
  await render();
})();
</script>
{% endblock %}
