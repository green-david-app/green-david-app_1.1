{% extends "layouts/layout_mobile_" + mobile_mode + ".html" %}

{% block content %}
<div class="widget-editor">
    <h2>Upravit dashboard</h2>
    
    <div class="editor-tabs">
        <button class="tab-btn {% if mobile_mode == 'field' %}active{% endif %}" onclick="switchMode('field')">
            Field Mode
        </button>
        <button class="tab-btn {% if mobile_mode == 'full' %}active{% endif %}" onclick="switchMode('full')">
            Full Mode
        </button>
    </div>
    
    <div class="active-widgets" id="activeWidgets">
        <h3>Aktivní widgety</h3>
        <div id="activeWidgetsList" class="widget-list">
            {% for widget_id in current_widgets %}
                {% set widget = widget_registry[widget_id] %}
                {% if widget %}
                <div class="widget-item" data-id="{{ widget_id }}" draggable="true">
                    <span class="drag-handle">⋮⋮</span>
                    <span class="widget-name">{{ widget.title }}</span>
                    <button class="btn-remove" onclick="removeWidget('{{ widget_id }}')">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    
    <div class="available-widgets">
        <h3>Dostupné widgety</h3>
        <div id="availableWidgetsList" class="widget-list">
            {% for widget_id, widget in available_widgets.items() %}
                {% if widget_id not in current_widgets %}
                <div class="widget-item available" data-id="{{ widget_id }}">
                    <span class="widget-name">{{ widget.title }}</span>
                    <button class="btn-add" onclick="addWidget('{{ widget_id }}')">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                    </button>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    
    <div class="editor-actions">
        <button class="btn btn-secondary" onclick="resetToDefault()">Obnovit výchozí</button>
        <button class="btn btn-primary" onclick="saveLayout()">Uložit</button>
    </div>
</div>

<script src="/static/js/widgets.js"></script>
<script>
const currentMode = '{{ mobile_mode }}';
const currentWidgets = {{ current_widgets|tojson }};

function switchMode(mode) {
    window.location.href = `/mobile/edit-dashboard?mode=${mode}`;
}
</script>
</div>
{% endblock %}
