<!doctype html><html lang="cs"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Archiv zakázek</title><link rel="stylesheet" href="/static/style.css"/></head><body><header class="app-header"><div class="app-header-container"><a href="/" class="app-header-brand"><img src="/logo.jpg" alt="green david app" class="app-header-logo" onerror="this.src='/logo.svg'"/><div class="app-header-text"><div class="app-header-title">green david app</div></div></a><div class="app-header-actions"><div id="userbox" class="app-header-user"></div><a href="/settings.html" class="app-header-settings" title="Nastavení"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"/></svg></a></div></div></header><div class="container"><h1>Archiv zakázek</h1><div id="arch"></div></div><script>
(async () => {
  const res = await fetch('/api/jobs/archive'); const data = await res.json();
  const root = document.getElementById('arch');
  if(!data.ok){ root.textContent = 'Chyba načítání archivu'; return; }
  const months = Object.keys(data.months).sort().reverse();
  if(months.length===0){ root.innerHTML = '<p>Archiv je prázdný.</p>'; return; }
  months.forEach(m => { const sec = document.createElement('section'); sec.innerHTML = `<h2>${m}</h2>`;
    const list = document.createElement('div'); list.className = 'grid';
    (data.months[m]||[]).forEach(item => { const j=item.job||{}; const el=document.createElement('div'); el.className='card';
      el.innerHTML=`<div class="card-c"><div><strong>${j.title||j.name||'Bez názvu'}</strong></div>
      <div>${j.client||''} • ${j.city||''} • ${j.code||''}</div><div>Dokončeno: ${j.completed_at||''}</div>
      <details><summary>Detaily</summary><pre style="white-space:pre-wrap">${(j.note||'')}</pre></details></div>`;
      list.appendChild(el); });
    sec.appendChild(list); root.appendChild(sec); }); })();</script><script>
      async function refreshUserBox(){
        const box = document.getElementById("userbox");
        try{
          const j = await fetch("/api/me").then(r=>r.json());
          if(j.authenticated){
            box.innerHTML = `<span>Úkoly: <strong style="color:#e8eef2;">${j.tasks_count||0}</strong></span> &nbsp; <button class="btn btn-ghost btn-sm" id="logout-btn" style="padding:6px 12px;font-size:13px;">Odhlásit</button>`;
            document.getElementById("logout-btn").onclick = async ()=>{ await fetch("/api/logout",{method:"POST"}); location.reload(); };
          } else {
            box.innerHTML = '<span>Nepřihlášen</span>';
          }
        }catch(e){ box.innerText = ""; }
      }
      refreshUserBox();
</script></body></html>