<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Settings</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      padding: 40px;
      transition: all 0.3s ease;
    }
    
    /* Theme styles */
    [data-theme="dark"] body {
      background: #1a1a1a;
      color: #ffffff;
    }
    
    [data-theme="light"] body {
      background: #ffffff;
      color: #0a0e11;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .card {
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }
    
    [data-theme="dark"] .card {
      background: #1f2428;
      border: 1px solid #30363d;
    }
    
    [data-theme="light"] .card {
      background: #ffffff;
      border: 1px solid #e1e4e8;
    }
    
    h1, h2 {
      margin-bottom: 20px;
    }
    
    .setting-group {
      margin-bottom: 25px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    select, button {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      font-size: 15px;
      border: 1px solid #30363d;
      background: #0d1117;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    [data-theme="light"] select,
    [data-theme="light"] button {
      background: #f6f8fa;
      border: 1px solid #d0d7de;
      color: #24292f;
    }
    
    button {
      background: var(--accent-green, #b0fba5);
      color: #0a0e11;
      font-weight: 600;
      margin-top: 10px;
    }
    
    button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    
    .switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 28px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #4a4a4a;
      transition: .3s;
      border-radius: 28px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: var(--accent-green, #b0fba5);
    }
    
    input:checked + .slider:before {
      transform: translateX(24px);
    }
    
    .status {
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 14px;
    }
    
    .status.success {
      background: rgba(46, 160, 67, 0.15);
      color: #3fb950;
      border: 1px solid rgba(46, 160, 67, 0.4);
    }
    
    .switch-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1 data-i18n="settings.title">Testovací stránka nastavení</h1>
      
      <div class="setting-group">
        <label data-i18n="settings.theme">Téma</label>
        <div class="switch-wrapper">
          <span data-i18n="theme.light">Světlé</span>
          <label class="switch">
            <input type="checkbox" id="darkModeToggle">
            <span class="slider"></span>
          </label>
          <span data-i18n="theme.dark">Tmavé</span>
        </div>
      </div>
      
      <div class="setting-group">
        <label for="userLanguage" data-i18n="settings.language">Jazyk</label>
        <select id="userLanguage">
          <option value="cs">Čeština</option>
          <option value="en">English</option>
        </select>
      </div>
      
      <button onclick="testSettings()">Test uložení nastavení</button>
      
      <div id="status" class="status success" style="display: none;">
        <strong data-i18n="status.saved">✓ Nastavení uloženo!</strong><br>
        <span id="statusDetails"></span>
      </div>
    </div>
    
    <div class="card">
      <h2 data-i18n="debug.title">Debug Info</h2>
      <pre id="debugInfo" style="font-size: 12px; overflow-x: auto;"></pre>
    </div>
  </div>

  <!-- Load app-settings.js from the app -->
  <script src="/app-settings.js"></script>
  
  <script>
    // Test translations
    const testDict = {
      cs: {
        'settings.title': 'Testovací stránka nastavení',
        'settings.theme': 'Téma',
        'settings.language': 'Jazyk',
        'theme.light': 'Světlé',
        'theme.dark': 'Tmavé',
        'status.saved': '✓ Nastavení uloženo!',
        'debug.title': 'Debug Info'
      },
      en: {
        'settings.title': 'Settings Test Page',
        'settings.theme': 'Theme',
        'settings.language': 'Language',
        'theme.light': 'Light',
        'theme.dark': 'Dark',
        'status.saved': '✓ Settings saved!',
        'debug.title': 'Debug Info'
      }
    };
    
    function updateDebugInfo() {
      const settings = localStorage.getItem('appSettings');
      const parsed = settings ? JSON.parse(settings) : null;
      
      document.getElementById('debugInfo').textContent = JSON.stringify({
        localStorage: parsed,
        currentTheme: document.documentElement.getAttribute('data-theme'),
        currentLang: document.documentElement.getAttribute('lang'),
        AppI18n: typeof window.AppI18n !== 'undefined' ? 'loaded' : 'missing'
      }, null, 2);
    }
    
    function applyLocalTranslations() {
      const settings = localStorage.getItem('appSettings');
      const lang = settings ? (JSON.parse(settings).userLanguage || 'cs') : 'cs';
      
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (testDict[lang] && testDict[lang][key]) {
          el.textContent = testDict[lang][key];
        }
      });
    }
    
    function testSettings() {
      const status = document.getElementById('status');
      const details = document.getElementById('statusDetails');
      
      try {
        const settings = localStorage.getItem('appSettings');
        const parsed = settings ? JSON.parse(settings) : {};
        
        details.innerHTML = `
          Téma: <strong>${parsed.theme || 'není nastaveno'}</strong><br>
          Jazyk: <strong>${parsed.userLanguage || 'není nastaven'}</strong><br>
          AppI18n: <strong>${typeof window.AppI18n !== 'undefined' ? 'dostupný' : 'nedostupný'}</strong>
        `;
        
        status.style.display = 'block';
        updateDebugInfo();
      } catch (e) {
        alert('Chyba: ' + e.message);
      }
    }
    
    // Setup event listeners
    document.getElementById('darkModeToggle').addEventListener('change', function(e) {
      const theme = e.target.checked ? 'dark' : 'light';
      
      // Save to localStorage
      const settings = localStorage.getItem('appSettings');
      const parsed = settings ? JSON.parse(settings) : {};
      parsed.theme = theme;
      localStorage.setItem('appSettings', JSON.stringify(parsed));
      
      // Apply immediately
      document.documentElement.setAttribute('data-theme', theme);
      
      updateDebugInfo();
    });
    
    document.getElementById('userLanguage').addEventListener('change', function(e) {
      const lang = e.target.value;
      
      // Save to localStorage
      const settings = localStorage.getItem('appSettings');
      const parsed = settings ? JSON.parse(settings) : {};
      parsed.userLanguage = lang;
      localStorage.setItem('appSettings', JSON.stringify(parsed));
      
      // Apply via AppI18n if available
      if (window.AppI18n && typeof window.AppI18n.setLanguage === 'function') {
        window.AppI18n.setLanguage(lang);
      } else {
        // Fallback to local translations
        document.documentElement.setAttribute('lang', lang);
        applyLocalTranslations();
      }
      
      updateDebugInfo();
    });
    
    // Initialize
    window.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        const settings = localStorage.getItem('appSettings');
        if (settings) {
          const parsed = JSON.parse(settings);
          
          // Apply theme
          if (parsed.theme) {
            document.documentElement.setAttribute('data-theme', parsed.theme);
            document.getElementById('darkModeToggle').checked = parsed.theme === 'dark';
          }
          
          // Apply language
          if (parsed.userLanguage) {
            document.getElementById('userLanguage').value = parsed.userLanguage;
            if (window.AppI18n) {
              window.AppI18n.setLanguage(parsed.userLanguage);
            } else {
              applyLocalTranslations();
            }
          }
        }
        
        updateDebugInfo();
      }, 100);
    });
  </script>
</body>
</html>
