<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail ƒçlena teamu - Green David App</title>
    <link rel="stylesheet" href="/static/style.css"/>
    <link rel="stylesheet" href="/static/css/app.css"/>
    <link rel="stylesheet" href="/static/css/glass-design.css"/>
    <script src="/app-settings.js"></script>
    <style>
        :root {
            --bg-primary: #1a1d1f;
            --bg-secondary: #252a2e;
            --bg-card: rgba(255,255,255,0.05);
            --text-primary: #e8eef2;
            --text-secondary: #9ca8b3;
            --mint: #B2FBA5;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            padding-bottom: 70px;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header button {
            background: transparent;
            border: none;
            color: var(--mint);
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
        }

        .header h1 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .employee-detail {
            max-width: 800px;
            margin: 0 auto;
            padding: 24px 20px;
        }

        .avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--mint);
            color: #1a1a1a;
            font-size: 40px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .employee-detail h2 {
            text-align: center;
            font-size: 28px;
            margin: 0 0 8px;
        }

        .employee-detail > p {
            text-align: center;
            color: var(--text-secondary);
            font-size: 16px;
            margin: 0 0 32px;
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 32px;
        }

        .contact-info a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-card);
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            transition: background 0.2s;
        }

        .contact-info a:hover {
            background: rgba(74, 222, 128, 0.1);
        }

        .statistics {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .statistics h3 {
            margin: 0 0 16px;
            font-size: 18px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-item span {
            color: var(--text-secondary);
        }

        .stat-item strong {
            color: var(--mint);
            font-size: 16px;
        }

        .recent-activity {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
        }

        .recent-activity h3 {
            margin: 0 0 16px;
            font-size: 18px;
        }

        .activity-item {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .activity-item:last-child {
            border-bottom: none;
        }
    
.employee-account{margin:4px 0 0 0;color:var(--text-muted);font-size:14px;}
</style>
    <link rel="stylesheet" href="/static/css/sidebar.css"/>
    <link rel="stylesheet" href="/static/css/responsive.css"/>
</head>
<body class="has-sidebar">
  <div id="app-header"></div>
    <div id="app-sidebar"></div>
    <div class="header">
        <button onclick="history.back()">‚Üê Zpƒõt</button>
        <h1>Detail ƒçlena teamu</h1>
    </div>
    
    <div class="employee-detail" id="employeeDetail">
        <div class="avatar-large" id="avatarLarge">G</div>
        <h2 id="employee-name">Naƒç√≠t√°m...</h2>
        <p id="employee-role">‚Äî</p>
        <p id="employee-account-role" class="employee-account">√öƒçet: ‚Äî</p>
        
        <div class="contact-info" id="contactInfo">
            <!-- Naƒçte se dynamicky -->
        </div>
        
        <div class="statistics">
            <h3>Statistiky</h3>
            <div class="stat-item">
                <span>Tento t√Ωden:</span>
                <strong id="stat-week">0h</strong>
            </div>
            <div class="stat-item">
                <span>Aktivn√≠ zak√°zky:</span>
                <strong id="stat-jobs">0</strong>
            </div>
            <div class="stat-item">
                <span>Dokonƒçen√© √∫koly:</span>
                <strong id="stat-tasks">0</strong>
            </div>
        </div>
        
        <div class="recent-activity">
            <h3>Posledn√≠ v√Ωkazy</h3>
            <div id="recentTimesheets">
                <p style="color: var(--text-secondary);">≈Ω√°dn√© v√Ωkazy</p>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div id="bottom-nav-container"></div>
    <script src="/static/bottom-nav.js"></script>
    <link rel="stylesheet" href="/static/icons.css">

    <script>
        // Z√≠skej ID z URL
        const urlParams = new URLSearchParams(window.location.search);
        const employeeId = parseInt(urlParams.get('id'));

        async function loadEmployeeDetail() {
            try {
                // Naƒçti data ƒçlena teamu
                const [employeesRes, jobsRes, tasksRes, timesheetsRes] = await Promise.all([
                    fetch('/api/employees'),
                    fetch('/api/jobs').catch(() => ({ok: false})),
                    fetch('/api/tasks').catch(() => ({ok: false})),
                    fetch('/api/timesheets').catch(() => ({ok: false}))
                ]);

                if (!employeesRes.ok) {
                    throw new Error('Failed to load employee');
                }

                const employeesData = await employeesRes.json();
                const employee = employeesData.employees?.find(e => e.id === employeeId);

                if (!employee) {
                    document.getElementById('employee-name').textContent = 'ƒålen teamu nenalezen';
                    return;
                }

                // Zobraz z√°kladn√≠ info
                const initials = (employee.name || '??').split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                document.getElementById('avatarLarge').textContent = initials;
                document.getElementById('employee-name').textContent = employee.name || 'Bez jm√©na';
                document.getElementById('employee-role').textContent = employee.role || 'ƒålen teamu';
                const acctEl = document.getElementById('employee-account-role');
                if (acctEl) {
                    acctEl.textContent = '√öƒçet: ' + (employee.has_account ? (employee.account_role || '‚Äî') : '≈æ√°dn√Ω');
                }

                // Kontaktn√≠ info
                const contactInfo = document.getElementById('contactInfo');
                contactInfo.innerHTML = '';
                if (employee.phone && employee.phone.trim()) {
                    contactInfo.innerHTML += `<a href="tel:${employee.phone}">üìû ${employee.phone}</a>`;
                } else {
                    contactInfo.innerHTML += `<div style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-card); border-radius: 8px; color: var(--text-secondary);">üìû <span>Zat√≠m ≈æ√°dn√° data</span></div>`;
                }
                if (employee.email && employee.email.trim()) {
                    contactInfo.innerHTML += `<a href="mailto:${employee.email}">‚úâÔ∏è ${employee.email}</a>`;
                } else {
                    contactInfo.innerHTML += `<div style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-card); border-radius: 8px; color: var(--text-secondary);">‚úâÔ∏è <span>Zat√≠m ≈æ√°dn√° data</span></div>`;
                }
                if (employee.address && employee.address.trim()) {
                    contactInfo.innerHTML += `<div style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-card); border-radius: 8px; color: var(--text-primary);">${employee.address}</div>`;
                } else {
                    contactInfo.innerHTML += `<div style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-card); border-radius: 8px; color: var(--text-secondary);"><span>Zat√≠m ≈æ√°dn√° data</span></div>`;
                }

                // Statistiky
                let jobs = [];
                let tasks = [];
                let timesheets = [];

                if (jobsRes.ok) {
                    const jobsData = await jobsRes.json();
                    jobs = jobsData.jobs || jobsData || [];
                }

                if (tasksRes.ok) {
                    const tasksData = await tasksRes.json();
                    tasks = tasksData.tasks || tasksData || [];
                }

                if (timesheetsRes.ok) {
                    const timesheetsData = await timesheetsRes.json();
                    timesheets = timesheetsData.timesheets || timesheetsData || [];
                }

                // Vypoƒç√≠tej statistiky
                const today = new Date();
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay());
                weekStart.setHours(0, 0, 0, 0);

                const weeklyHours = timesheets
                    .filter(ts => ts.employee_id === employeeId && new Date(ts.date) >= weekStart)
                    .reduce((sum, ts) => sum + (ts.hours || 0), 0);

                const activeJobs = jobs.filter(j => {
                    const assignments = tasks.filter(t => t.job_id === j.id && t.employee_id === employeeId);
                    return assignments.length > 0 && j.status !== 'completed' && j.status !== 'Dokonƒçeno';
                }).length;

                const completedTasks = tasks.filter(t => t.employee_id === employeeId && t.status === 'completed').length;

                document.getElementById('stat-week').textContent = `${weeklyHours.toFixed(1)}h`;
                document.getElementById('stat-jobs').textContent = activeJobs;
                document.getElementById('stat-tasks').textContent = completedTasks;

                // Posledn√≠ v√Ωkazy - naƒçti skuteƒçn√° data z API
                const timesheetsRes2 = await fetch(`/api/timesheets?employee_id=${employeeId}`);
                let recentTimesheets = [];
                if (timesheetsRes2.ok) {
                    const timesheetsData2 = await timesheetsRes2.json();
                    const allTimesheets = timesheetsData2.rows || timesheetsData2.timesheets || [];
                    recentTimesheets = allTimesheets
                        .filter(ts => ts.employee_id === employeeId)
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 5);
                }

                const recentContainer = document.getElementById('recentTimesheets');
                if (recentTimesheets.length > 0) {
                    recentContainer.innerHTML = recentTimesheets.map(ts => {
                        const jobTitle = jobs.find(j => j.id === ts.job_id)?.title || ts.job_title || 'Nezn√°m√° zak√°zka';
                        return `
                        <div class="activity-item">
                            <div style="display: flex; justify-content: space-between;">
                                <span>${new Date(ts.date).toLocaleDateString('cs-CZ')}</span>
                                <strong style="color: var(--mint);">${ts.hours || 0}h</strong>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">${jobTitle}</div>
                        </div>
                    `;
                    }).join('');
                } else {
                    recentContainer.innerHTML = '<p style="color: var(--text-secondary);">Zat√≠m ≈æ√°dn√° data</p>';
                }

            } catch (error) {
                console.error('Error loading employee detail:', error);
                document.getElementById('employee-name').textContent = 'Chyba p≈ôi naƒç√≠t√°n√≠';
            }
        }

        // Naƒçti p≈ôi naƒçten√≠ str√°nky
        if (employeeId) {
            loadEmployeeDetail();
        } else {
            document.getElementById('employee-name').textContent = 'Chyba: ID ƒçlena teamu nen√≠ zad√°no';
        }
    </script>
    <script src="/static/app-sidebar.js"></script>
  <script src="/static/app-header.js"></script>
</body>
</html>




