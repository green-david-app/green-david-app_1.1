
{% extends "base.html" %}
{% block content %}
<h1>Vyhledávání</h1>
<form action="/search" method="get" class="search-form">
  <input type="search" name="q" value="{{ q }}" placeholder="Zadejte hledaný text…">
  <button type="submit">Hledat</button>
</form>
{% if q and results|length == 0 %}
  <p class="muted">Nic nenalezeno pro <strong>{{ q }}</strong>.</p>
{% endif %}
<ul class="search-results">
  {% for r in results %}
    <li class="result">
      <div class="meta">{{ r.type }} • {{ r.date }}</div>
      <a class="title" href="{{ r.url }}">{{ r.title }}</a>
      {% if r.sub %}<div class="sub">{{ r.sub }}</div>{% endif %}
    </li>
  {% endfor %}
</ul>
{% endblock %}

<!-- SPA-NAV-INJECTION -->

<script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.js-search-target').forEach(function (el) {
    el.addEventListener('click', function (ev) {
      // Always navigate in-app using SPA query params if we can
      var t = el.getAttribute('data-type') || '';
      var id = el.getAttribute('data-id') || '';
      var href = el.getAttribute('href') || '';
      var next = null;

      var norm = t.toLowerCase();
      if (id) {
        if (norm.includes('zakáz') || norm.includes('zakaz')) { next = '/?tab=jobs&jobId=' + id; }
        else if (norm.includes('zaměst') || norm.includes('zamest')) { next = '/?tab=employees&employeeId=' + id; }
        else if (norm.includes('úkol') || norm.includes('ukol')) { next = '/?tab=tasks&taskId=' + id; }
      }
      if (!next && href && href !== '#') { next = href; }
      if (next) {
        ev.preventDefault();
        window.location.assign(next);
      }
    });
  });
});
</script>
