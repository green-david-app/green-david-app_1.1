<!doctype html><html lang="cs"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Výkazy hodin – green david app</title>
<link rel="stylesheet" href="/style.css"/>
</head><body>
<header class="header">
  <div class="brand">
    <img src="/logo.svg" class="brand-logo" alt="green david"/>
    <div><div class="brand-title">green david app</div><div class="brand-sub">Výkazy hodin</div></div>
    <div class="right small"><a class="ghost" href="/">← Zpět do aplikace</a></div>
  </div>
</header>
<main class="container"><div id="app"></div></main>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script>
  async function api(url, opts){ const r = await fetch(url, {headers: {'Content-Type':'application/json'}, credentials:'same-origin', ...(opts||{})}); if(!r.ok) throw new Error(await r.text()); return await r.json(); }
</script>
<script type="text/babel" data-presets="env,react">
const {useState,useEffect} = React;
function Timesheets(){
  const [rows,setRows]=useState([]);
  const [emps,setEmps]=useState([]);
  const [f,setF]=useState({from:"",to:"",emp:""});
  async function load(){
    const [ts, es] = await Promise.all([api("/gd/api/timesheets"), api("/gd/api/employees")]);
    setRows(ts || []); setEmps(es || []);
  }
  useEffect(()=>{ load(); }, []);
  const filtered = rows.filter(r=> (!f.emp || String(r.employee_id)===String(f.emp)) &&
    (!f.from || r.date>=f.from) && (!f.to || r.date<=f.to));
  const total = filtered.reduce((s,r)=>s + (parseFloat(r.hours)||0), 0);
  return (<div className="card">
    <div className="card-h">
      <div>Výkazy hodin</div>
      <div className="row-gap">
        <a className="ghost" href={`/gd/api/timesheets/export${f.from||f.to ? `?from=${f.from}&to=${f.to}` : ''}`}>Export CSV</a>
      </div>
    </div>
    <div className="card-c">
      <div className="form-row">
        <select value={f.emp} onChange={e=>setF({...f,emp:e.target.value})}>
          <option value="">— Všichni zaměstnanci —</option>
          {emps.map(e=>(<option key={e.id} value={e.id}>{e.name}</option>))}
        </select>
        <input type="date" value={f.from} onChange={e=>setF({...f,from:e.target.value})}/>
        <input type="date" value={f.to} onChange={e=>setF({...f,to:e.target.value})}/>
        <button className="ghost" onClick={()=>setF({from:"",to:"",emp:""})}>Zrušit filtr</button>
      </div>
      <div className="small" style={{marginBottom:'.5rem'}}>Celkem: <b>{total.toFixed(2)} h</b> ({filtered.length} záznamů)</div>
      <table className="table">
        <thead><tr><th>Datum</th><th>Zaměstnanec</th><th>Hodiny</th><th>Místo</th><th>Popis</th></tr></thead>
        <tbody>
          {filtered.map(r=>(<tr key={r.id}><td>{r.date}</td><td>{(emps.find(e=>e.id===r.employee_id)||{}).name||r.employee_id}</td><td>{r.hours}</td><td>{r.place||""}</td><td>{r.activity||""}</td></tr>))}
        </tbody>
      </table>
    </div>
  </div>);
}
function App(){ return <Timesheets/> }
ReactDOM.createRoot(document.getElementById('app')).render(<App/>);
</script>
</body></html>
