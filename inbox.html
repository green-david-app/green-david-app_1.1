<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Moje práce • green david app</title>
  <link rel="stylesheet" href="/static/style.css"/>
  <link rel="stylesheet" href="/static/css/app.css"/>
  <link rel="stylesheet" href="/static/css/glass-design.css"/>
  <link rel="stylesheet" href="/static/css/global-search.css"/>
  <link rel="stylesheet" href="/static/icons.css"/>
  <link rel="stylesheet" href="/static/css/sidebar.css"/>
  <link rel="stylesheet" href="/static/css/responsive.css"/>
  <script src="/app-settings.js"></script>
  <script src="/static/app-header.js"></script>
  <script src="/static/global-search.js"></script>
  <style>
    :root {
      --bg-primary: #1a1d1f;
      --bg-card: rgba(255,255,255,0.06);
      --border-primary: rgba(255,255,255,0.08);
      --text-primary: #e8eef2;
      --text-secondary: #9ca8b3;
      --mint: #4ade80;
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .inbox-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px 16px 100px;
    }

    .inbox-header {
      margin-bottom: 24px;
    }

    .inbox-header h1 {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .inbox-header h1 img {
      width: 32px;
      height: 32px;
      object-fit: contain;
      border-radius: 8px;
    }

    .inbox-header .subtitle {
      color: var(--text-secondary);
      font-size: 14px;
      margin: 0;
    }

    .inbox-header .warning {
      color: #fbbf24;
      font-size: 13px;
      margin-top: 8px;
      padding: 8px 12px;
      background: rgba(251,191,36,0.1);
      border: 1px solid rgba(251,191,36,0.2);
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    /* Tabs */
    .inbox-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 4px;
    }

    .inbox-tab {
      padding: 10px 20px;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .inbox-tab:hover {
      border-color: rgba(74,222,128,0.3);
      color: #94a3b8;
    }

    .inbox-tab.active {
      background: rgba(74,222,128,0.1);
      border-color: rgba(74,222,128,0.2);
      color: var(--mint);
      box-shadow: 0 0 12px rgba(74,222,128,0.1);
    }

    .inbox-tab svg {
      width: 16px;
      height: 16px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }

    @media (max-width: 768px) {
      .inbox-tab {
        font-size: 12px;
        padding: 8px 14px;
      }
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* KPI Cards */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    @media (max-width: 768px) {
      .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
    }

    .kpi-card {
      background: linear-gradient(145deg, rgba(255,255,255,0.07) 0%, rgba(255,255,255,0.02) 100%);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.08);
      border-top-color: rgba(255,255,255,0.15);
      border-left-color: rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 16px;
      transition: all 0.3s ease;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(0,0,0,0.20), inset 0 1px 0 rgba(255,255,255,0.05);
    }

    .kpi-card:hover {
      transform: translateY(-2px);
      border-color: rgba(74,222,128,0.2);
      box-shadow: 0 8px 30px rgba(0,0,0,0.30), 0 0 20px rgba(74,222,128,0.06);
    }

    .kpi-label {
      font-size: 11px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .kpi-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .kpi-value.mint { color: var(--mint); }
    .kpi-value.warning { color: #fbbf24; }
    .kpi-value.danger { color: #f87171; }

    /* Glass Cards */
    .glass-card {
      background: linear-gradient(145deg, rgba(255,255,255,0.07) 0%, rgba(255,255,255,0.02) 100%);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.08);
      border-top-color: rgba(255,255,255,0.15);
      border-left-color: rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.20), inset 0 1px 0 rgba(255,255,255,0.05);
    }

    .glass-card h3 {
      margin: 0 0 16px;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .glass-card h3 svg {
      width: 18px;
      height: 18px;
      stroke: var(--mint);
    }

    /* Status Badges */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 10px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }

    .badge-open {
      background: rgba(59,130,246,0.15);
      color: #60a5fa;
      border: 1px solid rgba(59,130,246,0.2);
    }

    .badge-in-progress {
      background: rgba(251,191,36,0.15);
      color: #fbbf24;
      border: 1px solid rgba(251,191,36,0.2);
    }

    .badge-done {
      background: rgba(74,222,128,0.15);
      color: var(--mint);
      border: 1px solid rgba(74,222,128,0.2);
    }

    .badge-overdue {
      background: rgba(239,68,68,0.15);
      color: #ef4444;
      border: 1px solid rgba(239,68,68,0.2);
    }

    .badge-resolved {
      background: rgba(107,114,128,0.15);
      color: #9ca3af;
      border: 1px solid rgba(107,114,128,0.2);
    }

    /* Priority */
    .priority-high {
      border-left: 3px solid #ef4444;
    }

    .priority-medium {
      border-left: 3px solid #fbbf24;
    }

    .priority-low {
      border-left: 3px solid #60a5fa;
    }

    /* List Items */
    .list-item {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 8px;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .list-item:hover {
      background: rgba(255,255,255,0.05);
      border-color: rgba(74,222,128,0.2);
      transform: translateX(4px);
    }

    .list-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 8px;
    }

    .list-item-title {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
      flex: 1;
    }

    .list-item-meta {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .list-item-body {
      font-size: 12px;
      color: var(--text-secondary);
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      stroke: var(--text-secondary);
      opacity: 0.5;
      margin-bottom: 16px;
    }

    /* Timesheets Week View */
    .timesheet-week {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }

    @media (max-width: 768px) {
      .timesheet-week {
        grid-template-columns: 1fr;
      }
    }

    .timesheet-day {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 10px;
      padding: 12px;
      text-align: center;
    }

    .timesheet-day.today {
      border-color: var(--mint);
      background: rgba(74,222,128,0.05);
    }

    .timesheet-day-label {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .timesheet-day-hours {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* Calendar Week */
    .calendar-week {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .calendar-day {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      padding: 12px;
    }

    .calendar-day-header {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .calendar-events {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .calendar-event {
      font-size: 12px;
      padding: 6px 8px;
      border-radius: 6px;
      background: rgba(74,222,128,0.1);
      border-left: 3px solid var(--mint);
    }

    .calendar-event.training {
      background: rgba(96,165,250,0.1);
      border-left-color: #60a5fa;
    }

    /* Notifications */
    .notification-item {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 8px;
      border-left: 3px solid transparent;
    }

    .notification-item.unread {
      background: rgba(74,222,128,0.05);
      border-left-color: var(--mint);
    }

    .notification-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .notification-body {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .notification-time {
      font-size: 11px;
      color: var(--text-secondary);
      opacity: 0.7;
    }

    /* Quick Actions */
    .quick-actions {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .btn-action {
      padding: 10px 16px;
      background: linear-gradient(135deg, rgba(74,222,128,0.85), rgba(34,197,94,0.85));
      color: #0a0e11;
      border: 1px solid rgba(74,222,128,0.3);
      border-radius: 12px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(74,222,128,0.2);
    }

    .btn-action:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(74,222,128,0.3);
    }

    .btn-action svg {
      width: 16px;
      height: 16px;
      stroke: currentColor;
    }

    /* Plan Form */
    .plan-form-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    @media (max-width: 768px) {
      .plan-form-row {
        flex-direction: column;
      }
      .plan-form-row > * {
        width: 100%;
      }
    }

    .plan-input {
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.08);
      color: #e8eef2;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .plan-input:focus {
      outline: none;
      border-color: rgba(74,222,128,0.4);
      box-shadow: 0 0 0 3px rgba(74,222,128,0.1);
    }

    .plan-input option {
      background: #1a1d1f;
      color: #e8eef2;
    }

    .btn-primary {
      background: rgba(74,222,128,0.15);
      border: 1px solid rgba(74,222,128,0.3);
      color: #4ade80;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary:hover {
      background: rgba(74,222,128,0.25);
      border-color: rgba(74,222,128,0.4);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      color: #e8eef2;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-secondary:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.15);
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Plan Items */
    .plan-item {
      border-left: 3px solid transparent;
    }

    .plan-item[data-status="planned"] {
      border-left-color: #60a5fa;
    }

    .plan-item[data-status="confirmed"] {
      border-left-color: #4ade80;
    }

    .plan-item[data-status="absent"] {
      border-left-color: #ef4444;
    }

    .plan-item[data-status="sick"] {
      border-left-color: #f59e0b;
    }

    .plan-item[data-status="vacation"] {
      border-left-color: #8b5cf6;
    }

    .plan-item[data-status="uncertain"] {
      border-left-color: #9ca3af;
    }

    .btn-icon {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      display: inline-flex;
      align-items: center;
      transition: all 0.2s ease;
    }

    .btn-icon:hover {
      background: rgba(239,68,68,0.1);
      color: #ef4444;
    }

    .btn-icon svg {
      width: 14px;
      height: 14px;
      stroke: currentColor;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 100px;
      right: 20px;
      background: linear-gradient(145deg, rgba(26,35,50,0.95), rgba(15,23,35,0.95));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 12px 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      z-index: 10000;
      animation: slideIn 0.3s ease;
      max-width: 300px;
    }

    .toast.success {
      border-left: 3px solid #4ade80;
    }

    .toast.warning {
      border-left: 3px solid #fbbf24;
    }

    .toast.error {
      border-left: 3px solid #ef4444;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
  <link rel="stylesheet" href="/static/css/mobile-fix.css">
</head>
<body class="has-sidebar">
  <div id="app-header"></div>
  <div id="app-sidebar"></div>

  <div class="inbox-container">
    <div class="inbox-header">
      <h1>
        <img src="/static/img/logo.jpg" alt="Green David">
        Moje práce
      </h1>
      <p class="subtitle" id="subtitle">Načítání...</p>
      <div id="warning" style="display:none;" class="warning">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
          <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
          <line x1="12" y1="9" x2="12" y2="13"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        Váš účet není propojen se zaměstnancem
      </div>
    </div>

    <!-- Tabs -->
    <div class="inbox-tabs">
      <button class="inbox-tab active" data-tab="overview">
        <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Přehled
      </button>
      <button class="inbox-tab" data-tab="tasks">
        <svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Úkoly
      </button>
      <button class="inbox-tab" data-tab="jobs">
        <svg viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/></svg>
        Zakázky
      </button>
      <button class="inbox-tab" data-tab="timesheets">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        Výkazy
      </button>
      <button class="inbox-tab" data-tab="calendar">
        <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        Kalendář
      </button>
      <button class="inbox-tab" data-tab="notifications">
        <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
        Notifikace
      </button>
    </div>

    <!-- Tab Content: Overview -->
    <div id="tab-overview" class="tab-content active">
      <div class="kpi-grid" id="kpi-grid"></div>
      <div class="glass-card">
        <h3><svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Nejurgentnější úkoly</h3>
        <div id="urgent-tasks"></div>
      </div>
      <div class="glass-card">
        <h3 style="display:flex;justify-content:space-between;align-items:center;">
          <span style="display:flex;align-items:center;gap:8px;">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" fill="none" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            Dnešní plán
            <span class="badge badge-open" id="plans-count" style="font-size:10px;padding:2px 6px;">0</span>
          </span>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button id="btn-copy-yesterday" class="btn-secondary" style="padding:6px 12px;font-size:12px;display:inline-flex;align-items:center;gap:6px;" title="Kopírovat včerejší plán">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
              </svg>
              Jako včera
            </button>
            <button id="btn-add-plan" class="btn-primary" style="padding:6px 12px;font-size:12px;display:inline-flex;align-items:center;gap:6px;">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              Naplánovat
            </button>
          </div>
        </h3>
        
        <!-- Inline add form (hidden by default) -->
        <div id="plan-form" style="display:none;margin-top:16px;padding:16px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);border-radius:14px;">
          <div class="plan-form-row" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
            <select id="plan-employee" class="plan-input" style="flex:1;min-width:150px;">
              <option value="">Zaměstnanec...</option>
            </select>
            <select id="plan-job" class="plan-input" style="flex:1;min-width:150px;">
              <option value="">Zakázka...</option>
            </select>
            <input type="number" id="plan-hours" class="plan-input" value="8" min="0.5" max="16" step="0.5" style="width:80px;"/>
            <input type="text" id="plan-note" class="plan-input" placeholder="Poznámka..." style="flex:1;min-width:120px;"/>
            <button id="btn-save-plan" class="btn-primary" style="padding:8px 16px;font-size:13px;">Přidat</button>
            <button id="btn-cancel-plan" class="btn-secondary" style="padding:8px 12px;font-size:13px;">×</button>
          </div>
        </div>
        
        <!-- Plans list -->
        <div id="day-plans" style="margin-top:16px;"></div>
      </div>
      <div class="glass-card">
        <h3><svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>Nepřečtené notifikace</h3>
        <div id="recent-notifications"></div>
      </div>
    </div>

    <!-- Tab Content: Tasks -->
    <div id="tab-tasks" class="tab-content">
      <div class="quick-actions">
        <button class="btn-action" onclick="switchTab('tasks')">
          <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Obnovit
        </button>
      </div>
      <div class="glass-card">
        <h3>Moje úkoly</h3>
        <div id="tasks-list"></div>
      </div>
    </div>

    <!-- Tab Content: Jobs -->
    <div id="tab-jobs" class="tab-content">
      <div class="glass-card">
        <h3>Moje zakázky</h3>
        <div id="jobs-list"></div>
      </div>
    </div>

    <!-- Tab Content: Timesheets -->
    <div id="tab-timesheets" class="tab-content">
      <div class="quick-actions">
        <button class="btn-action" onclick="window.location.href='/templates/timesheets.html'">
          <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Přidat výkaz
        </button>
      </div>
      <div class="glass-card">
        <h3>Týdenní přehled</h3>
        <div id="timesheet-week"></div>
        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.06);">
          <div style="display: flex; justify-content: space-between; font-size: 14px;">
            <span>Celkem tento týden:</span>
            <strong id="week-total" style="color: var(--mint);">0h</strong>
          </div>
          <div style="display: flex; justify-content: space-between; font-size: 14px; margin-top: 8px;">
            <span>Celkem tento měsíc:</span>
            <strong id="month-total" style="color: var(--mint);">0h</strong>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Calendar -->
    <div id="tab-calendar" class="tab-content">
      <div class="glass-card">
        <h3>Týdenní kalendář</h3>
        <div id="calendar-week"></div>
      </div>
    </div>

    <!-- Tab Content: Notifications -->
    <div id="tab-notifications" class="tab-content">
      <div class="quick-actions">
        <button class="btn-action" onclick="markAllRead()">
          <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
          Označit vše jako přečtené
        </button>
      </div>
      <div id="notifications-list"></div>
    </div>
  </div>

  <script>
    let currentEmployeeId = null;
    let currentTab = 'overview';

    function esc(s) {
      return (s||'').toString().replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    function fmtDate(s) {
      if (!s) return '';
      try {
        const d = new Date(String(s).includes('T') ? s : (s+'T00:00:00'));
        if (isNaN(d.getTime())) return String(s);
        return d.toLocaleDateString('cs-CZ');
      } catch(_) { return String(s); }
    }

    function fmtTime(s) {
      if (!s) return '';
      try {
        return String(s).substring(0, 5);
      } catch(_) { return String(s); }
    }

    async function api(path) {
      const res = await fetch(path, {credentials:'same-origin'});
      const j = await res.json().catch(()=>null);
      if (!res.ok) throw new Error((j&&j.error)||res.statusText);
      return j;
    }

    function switchTab(tabName) {
      currentTab = tabName;
      document.querySelectorAll('.inbox-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
      document.getElementById(`tab-${tabName}`).classList.add('active');
      loadTabContent(tabName);
    }

    function getStatusBadge(status, dueDate) {
      const today = new Date().toISOString().split('T')[0];
      const isOverdue = dueDate && dueDate < today && status !== 'done' && status !== 'completed';
      if (isOverdue) return '<span class="badge badge-overdue">Přes termín</span>';
      if (status === 'open') return '<span class="badge badge-open">Otevřený</span>';
      if (status === 'in_progress') return '<span class="badge badge-in-progress">Probíhá</span>';
      if (status === 'done' || status === 'completed') return '<span class="badge badge-done">Hotovo</span>';
      if (status === 'resolved') return '<span class="badge badge-resolved">Vyřešeno</span>';
      return `<span class="badge">${esc(status)}</span>`;
    }

    function getPriorityClass(priority) {
      if (priority === 'high' || priority === 'urgent') return 'priority-high';
      if (priority === 'medium' || priority === 'normal') return 'priority-medium';
      return 'priority-low';
    }

    async function loadTabContent(tab) {
      if (!currentEmployeeId) return;

      try {
        if (tab === 'tasks') {
          const data = await api(`/api/tasks?employee_id=${currentEmployeeId}`);
          renderTasks(data.tasks || []);
        } else if (tab === 'jobs') {
          const data = await api(`/api/inbox/jobs?employee_id=${currentEmployeeId}`);
          renderJobs(data.jobs || []);
        } else if (tab === 'timesheets') {
          const monday = getMonday(new Date());
          const sunday = new Date(monday);
          sunday.setDate(sunday.getDate() + 6);
          const data = await api(`/api/timesheets?employee_id=${currentEmployeeId}&from=${monday.toISOString().split('T')[0]}&to=${sunday.toISOString().split('T')[0]}`);
          renderTimesheets(data.rows || []);
        } else if (tab === 'calendar') {
          const monday = getMonday(new Date());
          const sunday = new Date(monday);
          sunday.setDate(sunday.getDate() + 6);
          const data = await api(`/api/calendar?from=${monday.toISOString().split('T')[0]}&to=${sunday.toISOString().split('T')[0]}`);
          renderCalendar(data.events || data.items || []);
        } else if (tab === 'notifications') {
          const data = await api('/api/notifications');
          renderNotifications(data.rows || data.notifications || []);
        }
      } catch(e) {
        console.error(`Error loading ${tab}:`, e);
      }
    }

    function getMonday(d) {
      const day = d.getDay();
      const diff = d.getDate() - day + (day === 0 ? -6 : 1);
      return new Date(d.setDate(diff));
    }

    function renderKPIs(stats) {
      const grid = document.getElementById('kpi-grid');
      grid.innerHTML = `
        <div class="kpi-card" onclick="switchTab('tasks')">
          <div class="kpi-label">Aktivní úkoly</div>
          <div class="kpi-value mint">${stats.activeTasks || 0}</div>
        </div>
        <div class="kpi-card" onclick="switchTab('jobs')">
          <div class="kpi-label">Moje zakázky</div>
          <div class="kpi-value mint">${stats.activeJobs || 0}</div>
        </div>
        <div class="kpi-card" onclick="switchTab('timesheets')">
          <div class="kpi-label">Hodiny tento týden</div>
          <div class="kpi-value mint">${stats.weekHours || 0}h</div>
        </div>
        <div class="kpi-card" onclick="switchTab('timesheets')">
          <div class="kpi-label">Hodiny tento měsíc</div>
          <div class="kpi-value mint">${stats.monthHours || 0}h</div>
        </div>
        <div class="kpi-card" onclick="switchTab('notifications')">
          <div class="kpi-label">Nepřečtené notifikace</div>
          <div class="kpi-value ${stats.unreadNotifications > 0 ? 'warning' : ''}">${stats.unreadNotifications || 0}</div>
        </div>
      `;
    }

    function renderUrgentTasks(tasks) {
      const el = document.getElementById('urgent-tasks');
      const urgent = tasks
        .filter(t => t.status !== 'done' && t.status !== 'completed')
        .sort((a,b) => (a.due_date || '').localeCompare(b.due_date || ''))
        .slice(0, 3);
      
      if (!urgent.length) {
        el.innerHTML = '<div class="empty-state">Žádné urgentní úkoly</div>';
        return;
      }

      el.innerHTML = urgent.map(t => `
        <div class="list-item ${getPriorityClass(t.priority)}" onclick="switchTab('tasks')">
          <div class="list-item-header">
            <div class="list-item-title">${esc(t.title || '')}</div>
            <div class="list-item-meta">
              ${getStatusBadge(t.status, t.due_date)}
            </div>
          </div>
          <div class="list-item-body">
            ${t.job_name ? `<span>${esc(t.job_name)}</span>` : ''}
            ${t.due_date ? `<span>Termín: ${fmtDate(t.due_date)}</span>` : ''}
          </div>
        </div>
      `).join('');
    }

    function renderTodayPlan(plans) {
      const el = document.getElementById('today-plan');
      const plansListEl = document.getElementById('day-plans');
      const today = new Date().toISOString().split('T')[0];
      const todayPlans = plans.filter(p => p.date === today);
      
      // Update count badge
      document.getElementById('plans-count').textContent = todayPlans.length;
      
      if (!todayPlans.length) {
        if (el) el.innerHTML = '<div class="empty-state">Dnes není naplánováno</div>';
        if (plansListEl) plansListEl.innerHTML = '<div class="empty-state">Žádné plány</div>';
        return;
      }

      // Render in overview (only for current employee)
      if (el) {
        const myPlans = todayPlans.filter(p => p.employee_id === currentEmployeeId);
        if (myPlans.length) {
          el.innerHTML = myPlans.map(plan => `
            <div class="list-item">
              <div class="list-item-header">
                <div class="list-item-title">${esc(plan.job_name || 'Bez zakázky')}</div>
                <div class="list-item-meta">
                  <span class="badge badge-in-progress">${plan.planned_hours || 0}h</span>
                </div>
              </div>
              ${plan.note ? `<div class="list-item-body">${esc(plan.note)}</div>` : ''}
            </div>
          `).join('');
        } else {
          el.innerHTML = '<div class="empty-state">Dnes není naplánováno</div>';
        }
      }

      // Render full list in day-plans container
      if (plansListEl) {
        plansListEl.innerHTML = todayPlans.map(plan => `
          <div class="list-item plan-item" data-plan-id="${plan.id}" data-status="${plan.status || 'planned'}">
            <div class="list-item-header">
              <div class="list-item-title" style="display:flex;align-items:center;gap:8px;">
                <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                ${esc(plan.employee_name || 'Neznámý')}
              </div>
              <div class="list-item-meta" style="display:flex;align-items:center;gap:8px;">
                <span class="badge badge-in-progress">${plan.planned_hours || 0}h</span>
                <span class="badge" style="font-size:10px;">${esc(plan.status || 'planned')}</span>
                <button class="btn-icon btn-delete-plan" onclick="deletePlan(${plan.id})" title="Smazat">
                  <svg viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
                </button>
              </div>
            </div>
            <div class="list-item-body" style="display:flex;align-items:center;gap:8px;">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none" stroke-width="2">
                <path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/>
              </svg>
              ${esc(plan.job_name || 'Bez zakázky')}
              ${plan.job_code ? ` • ${esc(plan.job_code)}` : ''}
              ${plan.note ? ` • ${esc(plan.note)}` : ''}
            </div>
          </div>
        `).join('');
      }
    }

    function renderRecentNotifications(notifications) {
      const el = document.getElementById('recent-notifications');
      const unread = notifications.filter(n => !n.is_read).slice(0, 3);
      
      if (!unread.length) {
        el.innerHTML = '<div class="empty-state">Všechny notifikace přečtené</div>';
        return;
      }

      el.innerHTML = unread.map(n => `
        <div class="notification-item unread" onclick="switchTab('notifications')">
          <div class="notification-title">${esc(n.title || '')}</div>
          <div class="notification-body">${esc(n.body || '')}</div>
          <div class="notification-time">${fmtDate(n.created_at)}</div>
        </div>
      `).join('');
    }

    function renderTasks(tasks) {
      const el = document.getElementById('tasks-list');
      if (!tasks.length) {
        el.innerHTML = '<div class="empty-state">Nemáte žádné úkoly</div>';
        return;
      }

      el.innerHTML = tasks.map(t => `
        <div class="list-item ${getPriorityClass(t.priority)}">
          <div class="list-item-header">
            <div class="list-item-title">${esc(t.title || '')}</div>
            <div class="list-item-meta">
              ${getStatusBadge(t.status, t.due_date)}
            </div>
          </div>
          <div class="list-item-body">
            ${t.job_name ? `<span>${esc(t.job_name)}</span>` : ''}
            ${t.due_date ? `<span>Termín: ${fmtDate(t.due_date)}</span>` : ''}
            ${t.description ? `<span>${esc(t.description.substring(0, 100))}${t.description.length > 100 ? '...' : ''}</span>` : ''}
          </div>
        </div>
      `).join('');
    }

    function renderJobs(jobs) {
      const el = document.getElementById('jobs-list');
      if (!jobs.length) {
        el.innerHTML = '<div class="empty-state">Nemáte žádné zakázky</div>';
        return;
      }

      el.innerHTML = jobs.map(j => `
        <div class="list-item" onclick="window.location.href='/jobs.html#${j.id}'">
          <div class="list-item-header">
            <div class="list-item-title">${esc(j.name || '')}</div>
            <div class="list-item-meta">
              ${getStatusBadge(j.status, j.deadline)}
            </div>
          </div>
          <div class="list-item-body">
            ${j.client ? `<span>${esc(j.client)}</span>` : ''}
            ${j.city ? `<span>${esc(j.city)}</span>` : ''}
            ${j.deadline ? `<span>Termín: ${fmtDate(j.deadline)}</span>` : ''}
            ${j.completion_percent !== null ? `<span>${j.completion_percent}% hotovo</span>` : ''}
          </div>
        </div>
      `).join('');
    }

    function renderTimesheets(timesheets) {
      const weekEl = document.getElementById('timesheet-week');
      const monday = getMonday(new Date());
      const days = [];
      for (let i = 0; i < 7; i++) {
        const d = new Date(monday);
        d.setDate(d.getDate() + i);
        days.push(d.toISOString().split('T')[0]);
      }

      const today = new Date().toISOString().split('T')[0];
      const dayNames = ['Po', 'Út', 'St', 'Čt', 'Pá', 'So', 'Ne'];
      
      weekEl.innerHTML = days.map((day, idx) => {
        const dayHours = timesheets
          .filter(ts => ts.date === day)
          .reduce((sum, ts) => sum + (parseFloat(ts.hours) || 0), 0);
        return `
          <div class="timesheet-day ${day === today ? 'today' : ''}">
            <div class="timesheet-day-label">${dayNames[idx]}</div>
            <div class="timesheet-day-hours">${dayHours.toFixed(1)}h</div>
          </div>
        `;
      }).join('');

      const weekTotal = timesheets.reduce((sum, ts) => sum + (parseFloat(ts.hours) || 0), 0);
      document.getElementById('week-total').textContent = weekTotal.toFixed(1) + 'h';

      // Month total
      const monthStart = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
      const monthEnd = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0);
      api(`/api/timesheets?employee_id=${currentEmployeeId}&from=${monthStart.toISOString().split('T')[0]}&to=${monthEnd.toISOString().split('T')[0]}`)
        .then(data => {
          const monthTotal = (data.rows || []).reduce((sum, ts) => sum + (parseFloat(ts.hours) || 0), 0);
          document.getElementById('month-total').textContent = monthTotal.toFixed(1) + 'h';
        })
        .catch(() => {});
    }

    function renderCalendar(events) {
      const el = document.getElementById('calendar-week');
      const monday = getMonday(new Date());
      const days = [];
      for (let i = 0; i < 7; i++) {
        const d = new Date(monday);
        d.setDate(d.getDate() + i);
        days.push({
          date: d.toISOString().split('T')[0],
          dayName: d.toLocaleDateString('cs-CZ', { weekday: 'long' }),
          dayNum: d.getDate()
        });
      }

      el.innerHTML = days.map(day => {
        const dayEvents = events.filter(e => e.date === day.date);
        return `
          <div class="calendar-day">
            <div class="calendar-day-header">${day.dayName} ${day.dayNum}.</div>
            <div class="calendar-events">
              ${dayEvents.length ? dayEvents.map(e => `
                <div class="calendar-event ${e.kind === 'training' ? 'training' : ''}">
                  ${fmtTime(e.start_time || '')} - ${esc(e.title || '')}
                </div>
              `).join('') : '<div style="color: var(--text-secondary); font-size: 11px;">Žádné události</div>'}
            </div>
          </div>
        `;
      }).join('');
    }

    function renderNotifications(notifications) {
      const el = document.getElementById('notifications-list');
      if (!notifications.length) {
        el.innerHTML = '<div class="empty-state">Žádné notifikace</div>';
        return;
      }

      el.innerHTML = notifications.map(n => `
        <div class="notification-item ${n.is_read ? '' : 'unread'}" onclick="handleNotificationClick('${n.entity_type}', ${n.entity_id})">
          <div class="notification-title">${esc(n.title || '')}</div>
          <div class="notification-body">${esc(n.body || '')}</div>
          <div class="notification-time">${fmtDate(n.created_at)}</div>
        </div>
      `).join('');
    }

    function handleNotificationClick(entityType, entityId) {
      if (entityType === 'task') switchTab('tasks');
      else if (entityType === 'job') window.location.href = `/jobs.html#${entityId}`;
      else if (entityType === 'issue') window.location.href = `/issues.html#${entityId}`;
    }

    async function markAllRead() {
      try {
        await fetch('/api/notifications', {
          method: 'PATCH',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({all: 1}),
          credentials: 'same-origin'
        });
        loadTabContent('notifications');
        load(); // Refresh overview
      } catch(e) {
        alert('Chyba: ' + e.message);
      }
    }

    async function load() {
      try {
        const meData = await api('/api/me');
        if (!meData || !meData.authenticated) {
          document.getElementById('subtitle').textContent = 'Nejste přihlášen.';
          return;
        }

        const employeeId = (meData.user && meData.user.employee_id) || (meData.employee && meData.employee.id);
        const who = (meData.employee && meData.employee.name) || (meData.user && meData.user.name) || '';
        
        document.getElementById('subtitle').textContent = who ? `Přehled práce pro: ${who}` : 'Přehled práce.';

        if (!employeeId) {
          document.getElementById('warning').style.display = 'flex';
          return;
        }

        currentEmployeeId = employeeId;

        // Load overview data
        const [tasksData, jobsData, timesheetsData, notificationsData, dayPlansData] = await Promise.all([
          api(`/api/tasks?employee_id=${employeeId}`).catch(() => ({tasks: []})),
          api(`/api/inbox/jobs?employee_id=${employeeId}`).catch(() => ({jobs: []})),
          api(`/api/timesheets?employee_id=${employeeId}&from=${getMonday(new Date()).toISOString().split('T')[0]}&to=${new Date().toISOString().split('T')[0]}`).catch(() => ({rows: []})),
          api('/api/notifications').catch(() => ({rows: []})),
          api(`/api/planning/day-plans/${new Date().toISOString().split('T')[0]}`).catch(() => ({plans: []}))
        ]);

        const tasks = tasksData.tasks || [];
        const jobs = jobsData.jobs || [];
        const timesheets = timesheetsData.rows || [];
        const notifications = (notificationsData.rows || notificationsData.notifications || []);
        const plans = (dayPlansData.plans || []);

        const stats = {
          activeTasks: tasks.filter(t => t.status !== 'done' && t.status !== 'completed').length,
          activeJobs: jobs.filter(j => j.status !== 'archived' && j.status !== 'Archivováno').length,
          weekHours: timesheets.reduce((sum, ts) => sum + (parseFloat(ts.hours) || 0), 0),
          monthHours: 0, // Will be loaded separately
          unreadNotifications: notifications.filter(n => !n.is_read).length
        };

        renderKPIs(stats);
        renderUrgentTasks(tasks);
        renderTodayPlan(plans);
        renderRecentNotifications(notifications);
        
        // Check yesterday plans for copy button
        checkYesterdayPlans();

        // Load month hours
        const monthStart = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
        const monthEnd = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0);
        api(`/api/timesheets?employee_id=${employeeId}&from=${monthStart.toISOString().split('T')[0]}&to=${monthEnd.toISOString().split('T')[0]}`)
          .then(data => {
            const monthTotal = (data.rows || []).reduce((sum, ts) => sum + (parseFloat(ts.hours) || 0), 0);
            stats.monthHours = monthTotal;
            const monthKpi = document.querySelector('.kpi-card:nth-child(4) .kpi-value');
            if (monthKpi) monthKpi.textContent = monthTotal.toFixed(1) + 'h';
          })
          .catch(() => {});

      } catch(e) {
        console.error('Load error:', e);
        document.getElementById('subtitle').textContent = 'Chyba při načítání dat.';
      }
    }

    // Toast notification
    function showNotification(msg, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = msg;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Load employees and jobs for plan form
    let allEmployees = [];
    let allJobs = [];

    async function loadPlanFormData() {
      try {
        const [empData, jobsData] = await Promise.all([
          api('/api/employees').catch(() => ({employees: []})),
          api('/api/jobs').catch(() => ({jobs: []}))
        ]);
        allEmployees = empData.employees || [];
        allJobs = (jobsData.jobs || []).filter(j => j.status === 'Probíhá' || j.status === 'Plán');
        
        const empSelect = document.getElementById('plan-employee');
        const jobSelect = document.getElementById('plan-job');
        
        if (empSelect) {
          empSelect.innerHTML = '<option value="">Zaměstnanec...</option>' + 
            allEmployees.map(e => `<option value="${e.id}">${esc(e.name || '')}</option>`).join('');
        }
        
        if (jobSelect) {
          jobSelect.innerHTML = '<option value="">Zakázka...</option>' + 
            allJobs.map(j => `<option value="${j.id}">${esc(j.name || '')}${j.client ? ' - ' + esc(j.client) : ''}</option>`).join('');
        }
      } catch(e) {
        console.error('Error loading plan form data:', e);
      }
    }

    // Add plan
    async function addPlan() {
      const employeeId = document.getElementById('plan-employee').value;
      const jobId = document.getElementById('plan-job').value;
      const hours = parseFloat(document.getElementById('plan-hours').value) || 8;
      const note = document.getElementById('plan-note').value.trim();
      
      if (!employeeId) {
        showNotification('Vyberte zaměstnance', 'error');
        return;
      }
      
      try {
        const today = new Date().toISOString().slice(0, 10);
        const res = await fetch('/api/planning/day-plans', {
          method: 'POST',
          credentials: 'same-origin',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            date: today,
            employee_id: parseInt(employeeId),
            job_id: jobId ? parseInt(jobId) : null,
            planned_hours: hours,
            note: note,
            status: 'planned'
          })
        });
        
        const data = await res.json();
        if (data.success) {
          showNotification('Plán přidán', 'success');
          document.getElementById('plan-form').style.display = 'none';
          document.getElementById('plan-employee').value = '';
          document.getElementById('plan-job').value = '';
          document.getElementById('plan-hours').value = '8';
          document.getElementById('plan-note').value = '';
          
          // Reload plans
          const plansData = await api(`/api/planning/day-plans/${today}`);
          renderTodayPlan(plansData.plans || []);
          
          // Refresh notifications badge
          if (window.appHeader && typeof window.appHeader.refreshUserBox === 'function') {
            window.appHeader.refreshUserBox();
          }
        } else {
          showNotification('Chyba: ' + (data.error || 'Neznámá chyba'), 'error');
        }
      } catch(e) {
        showNotification('Chyba: ' + e.message, 'error');
      }
    }

    // Copy yesterday's plans
    async function copyYesterday() {
      const today = new Date().toISOString().slice(0, 10);
      const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
      
      try {
        const check = await fetch(`/api/planning/day-plans/${yesterday}`, {credentials: 'same-origin'});
        const checkData = await check.json();
        
        if (!checkData.plans || checkData.plans.length === 0) {
          showNotification('Včera nebyl žádný plán k zkopírování', 'warning');
          document.getElementById('btn-copy-yesterday').disabled = true;
          return;
        }
        
        if (!confirm(`Zkopírovat ${checkData.plans.length} plánů ze včerejška na dnešek?`)) return;
        
        const resp = await fetch('/api/planning/day-plans/copy', {
          method: 'POST',
          credentials: 'same-origin',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ from_date: yesterday, to_date: today })
        });
        
        const data = await resp.json();
        if (data.success) {
          showNotification(`Zkopírováno ${data.copied} plánů`, 'success');
          
          // Reload plans
          const plansData = await api(`/api/planning/day-plans/${today}`);
          renderTodayPlan(plansData.plans || []);
          
          // Refresh notifications badge
          if (window.appHeader && typeof window.appHeader.refreshUserBox === 'function') {
            window.appHeader.refreshUserBox();
          }
        } else {
          showNotification('Chyba: ' + (data.error || 'Neznámá chyba'), 'error');
        }
      } catch(e) {
        showNotification('Chyba: ' + e.message, 'error');
      }
    }

    // Delete plan
    async function deletePlan(planId) {
      if (!confirm('Opravdu smazat tento plán?')) return;
      
      try {
        const res = await fetch(`/api/planning/day-plans/${planId}`, {
          method: 'DELETE',
          credentials: 'same-origin'
        });
        
        const data = await res.json();
        if (data.success) {
          showNotification('Plán smazán', 'success');
          
          // Reload plans
          const today = new Date().toISOString().slice(0, 10);
          const plansData = await api(`/api/planning/day-plans/${today}`);
          renderTodayPlan(plansData.plans || []);
        } else {
          showNotification('Chyba: ' + (data.error || 'Neznámá chyba'), 'error');
        }
      } catch(e) {
        showNotification('Chyba: ' + e.message, 'error');
      }
    }

    // Check yesterday's plans on load
    async function checkYesterdayPlans() {
      const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
      try {
        const check = await fetch(`/api/planning/day-plans/${yesterday}`, {credentials: 'same-origin'});
        const checkData = await check.json();
        const btn = document.getElementById('btn-copy-yesterday');
        if (btn) {
          if (!checkData.plans || checkData.plans.length === 0) {
            btn.disabled = true;
            btn.title = 'Včera nebyl žádný plán';
          } else {
            btn.disabled = false;
            const dayName = new Date(yesterday).toLocaleDateString('cs-CZ', {weekday: 'short', day: 'numeric', month: 'numeric'});
            btn.title = `Kopírovat z ${dayName}`;
          }
        }
      } catch(e) {
        console.error('Error checking yesterday plans:', e);
      }
    }

    // Tab switching
    document.querySelectorAll('.inbox-tab').forEach(tab => {
      tab.addEventListener('click', () => switchTab(tab.dataset.tab));
    });

    // Plan form handlers
    document.getElementById('btn-add-plan')?.addEventListener('click', () => {
      const form = document.getElementById('plan-form');
      if (form.style.display === 'none' || !form.style.display) {
        form.style.display = 'block';
        loadPlanFormData();
      } else {
        form.style.display = 'none';
      }
    });

    document.getElementById('btn-cancel-plan')?.addEventListener('click', () => {
      document.getElementById('plan-form').style.display = 'none';
    });

    document.getElementById('btn-save-plan')?.addEventListener('click', () => {
      addPlan();
    });

    document.getElementById('btn-copy-yesterday')?.addEventListener('click', () => {
      copyYesterday();
    });

    // Initial load
    load();
    loadPlanFormData();
    checkYesterdayPlans();
  </script>
  <script src="/static/app-sidebar.js"></script>
</body>
</html>
