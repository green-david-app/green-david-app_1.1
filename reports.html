<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Reporty - green david app</title>
  <link rel="stylesheet" href="/style.css"/>
  <script src="/app-settings.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --bg-primary: #0a1628;
      --bg-secondary: #1a2942;
      --bg-card: rgba(255,255,255,0.05);
      --bg-elevated: rgba(255,255,255,0.08);
      --border-primary: rgba(255,255,255,0.1);
      --border-medium: rgba(255,255,255,0.15);
      --text-primary: #e8eef2;
      --text-secondary: #9ca8b3;
      --text-tertiary: #6b7580;
      --mint: #B2FBA5;
      --mint-dark: #B2FBA5;
      --warning: #fb923c;
      --danger: #f87171;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    .reports-page {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }

    .reports-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .reports-header h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-primary {
      padding: 10px 20px;
      background: var(--mint);
      border: 1px solid var(--mint);
      border-radius: 8px;
      color: #0a0e11;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      background: var(--mint-dark);
      border-color: var(--mint-dark);
    }
    
    .btn-primary svg {
      stroke: #0a0e11;
      color: #0a0e11;
    }

    .btn-secondary {
      padding: 10px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      color: var(--text-primary);
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: var(--bg-elevated);
    }

    /* Report Types */
    .report-types {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .report-type-card {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: 12px;
      padding: 24px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .report-type-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      border-color: var(--mint);
    }

    .report-type-card h3 {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 8px 0;
    }

    .report-type-card p {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0 0 16px 0;
    }

    .report-type-card .icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .report-features {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .report-features li {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 4px;
      padding-left: 16px;
      position: relative;
    }

    .report-features li:before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: var(--mint);
    }

    /* Report Generator */
    .report-generator {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 32px;
      display: none;
    }

    .report-generator.show {
      display: block;
    }

    .generator-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .generator-header h2 {
      font-size: 24px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: inherit;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--mint);
    }

    .checkbox-group label {
      margin: 0;
      cursor: pointer;
    }

    /* Report Preview */
    .report-preview {
      background: white;
      border-radius: 8px;
      padding: 40px;
      margin-bottom: 24px;
      color: #333;
      min-height: 800px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .report-preview h1 {
      font-size: 32px;
      color: #0a1628;
      margin: 0 0 8px 0;
      border-bottom: 3px solid var(--mint);
      padding-bottom: 12px;
    }

    .report-preview .report-meta {
      color: #666;
      font-size: 14px;
      margin-bottom: 32px;
    }

    .report-section {
      margin-bottom: 32px;
    }

    .report-section h2 {
      font-size: 24px;
      color: #0a1628;
      margin: 0 0 16px 0;
      border-left: 4px solid var(--mint);
      padding-left: 12px;
    }

    .report-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
    }

    .report-table th,
    .report-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .report-table th {
      background: #f5f5f5;
      font-weight: 600;
      color: #0a1628;
    }

    .report-chart {
      margin: 24px 0;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
    }

    .report-stat {
      display: inline-block;
      padding: 16px 24px;
      background: #f5f5f5;
      border-radius: 8px;
      margin-right: 16px;
      margin-bottom: 16px;
    }

    .report-stat .label {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .report-stat .value {
      font-size: 24px;
      font-weight: 700;
      color: #0a1628;
    }

    /* Scheduled Reports */
    .scheduled-reports {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: 12px;
      padding: 24px;
    }

    .scheduled-reports h2 {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 20px 0;
    }

    .scheduled-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: var(--bg-elevated);
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .scheduled-info {
      flex: 1;
    }

    .scheduled-info h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 4px 0;
    }

    .scheduled-info p {
      font-size: 12px;
      color: var(--text-secondary);
      margin: 0;
    }

    .scheduled-actions {
      display: flex;
      gap: 8px;
    }

    .btn-icon {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      color: var(--text-primary);
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .btn-icon:hover {
      background: var(--mint);
      border-color: var(--mint);
      color: #0a0e11;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(31, 36, 40, 0.95);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      z-index: 100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 12px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s;
      border-radius: 8px;
      min-width: 60px;
    }

    .nav-item.active {
      color: var(--mint);
    }

    .nav-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-label {
      font-size: 11px;
      font-weight: 500;
    }

    @media (max-width: 768px) {
      .report-types {
        grid-template-columns: 1fr;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .report-preview {
        padding: 20px;
      }
    }
    @media (max-width: 768px) {
      .reports-header {
        flex-direction: column;
        align-items: stretch;
      }
      .reports-header h1 {
        font-size: 24px;
        margin-bottom: 12px;
      }
      .header-actions {
        flex-direction: column;
        width: 100%;
      }
      .header-actions .btn {
        width: 100%;
      }
      .report-types {
        grid-template-columns: 1fr;
      }
      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="reports-page">
    <!-- Header -->
    <div class="reports-header">
      <h1>
        <svg style="width:32px;height:32px;stroke:#B2FBA5;display:inline-block;vertical-align:middle;margin-right:12px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="20" x2="18" y2="10"/>
          <line x1="12" y1="20" x2="12" y2="4"/>
          <line x1="6" y1="20" x2="6" y2="14"/>
        </svg>
        Reporty
      </h1>
      <div class="header-actions">
        <button class="btn-secondary" onclick="showScheduledReports()">
          <svg style="width:18px;height:18px;display:inline-block;vertical-align:middle;margin-right:6px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          Pl√°novan√©
        </button>
      </div>
    </div>

    <!-- Report Types -->
    <div class="report-types">
      <div class="report-type-card" onclick="openReportGenerator('weekly')">
        <div class="icon">
          <svg style="width:24px;height:24px;stroke:#B2FBA5;display:inline-block;vertical-align:middle;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </div>
        <h3>T√Ωdenn√≠ report</h3>
        <p>P≈ôehled hodin, projekt≈Ø a √∫kol≈Ø za t√Ωden</p>
        <ul class="report-features">
          <li>Hodiny celkem</li>
          <li>Rozpad po projektech</li>
          <li>Rozpad po zamƒõstnanc√≠ch</li>
          <li>Dokonƒçen√© √∫koly</li>
          <li>Export PDF</li>
        </ul>
      </div>

      <div class="report-type-card" onclick="openReportGenerator('monthly')">
        <div class="icon">
          <svg style="width:48px;height:48px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
            <polyline points="17 6 23 6 23 12"/>
          </svg>
        </div>
        <h3>Mƒõs√≠ƒçn√≠ report</h3>
        <p>Finanƒçn√≠ p≈ôehled a produktivita za mƒõs√≠c</p>
        <ul class="report-features">
          <li>Finanƒçn√≠ p≈ôehled</li>
          <li>Top projekty</li>
          <li>Produktivita t√Ωmu</li>
          <li>Grafy trend≈Ø</li>
        </ul>
      </div>

      <div class="report-type-card" onclick="openReportGenerator('project')">
        <div class="icon">
          <svg style="width:48px;height:48px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/>
            <rect x="9" y="3" width="6" height="4" rx="1"/>
            <path d="M9 12h6"/>
            <path d="M9 16h6"/>
          </svg>
        </div>
        <h3>Projektov√Ω report</h3>
        <p>Detailn√≠ anal√Ωza jednoho projektu</p>
        <ul class="report-features">
          <li>Timeline prac√≠</li>
          <li>N√°klady vs rozpoƒçet</li>
          <li>Ziskovost</li>
          <li>Fotodokumentace</li>
        </ul>
      </div>
    </div>

    <!-- Report Generator -->
    <div class="report-generator" id="reportGenerator">
      <div class="generator-header">
        <h2 id="generatorTitle">Generovat report</h2>
        <button class="btn-secondary" onclick="closeGenerator()">‚úï Zav≈ô√≠t</button>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Datum od *</label>
          <input type="date" id="reportDateFrom" required>
        </div>
        <div class="form-group">
          <label>Datum do *</label>
          <input type="date" id="reportDateTo" required>
        </div>
      </div>

      <div class="form-group" id="projectSelectGroup" style="display:none;">
        <label>Projekt</label>
        <select id="reportProject">
          <option value="">Vyberte projekt</option>
        </select>
      </div>

      <div class="form-group">
        <label>Zahrnout sekce</label>
        <div id="reportSections"></div>
      </div>

      <div class="form-group">
        <label>Pozn√°mka (voliteln√©)</label>
        <textarea id="reportNote" placeholder="Dodateƒçn√© pozn√°mky k reportu..."></textarea>
      </div>

      <div class="form-group">
        <div class="checkbox-group">
          <input type="checkbox" id="scheduleReport">
          <label for="scheduleReport">Pl√°novat automatick√© generov√°n√≠</label>
        </div>
        <div id="scheduleOptions" style="display:none;margin-top:12px;">
          <div class="form-row">
            <div class="form-group">
              <label>Frekvence</label>
              <select id="scheduleFrequency">
                <option value="weekly">T√Ωdnƒõ (ka≈æd√Ω p√°tek)</option>
                <option value="monthly">Mƒõs√≠ƒçnƒõ (1. den mƒõs√≠ce)</option>
              </select>
            </div>
            <div class="form-group">
              <label>Email pro distribuci</label>
              <input type="email" id="scheduleEmail" placeholder="email@example.com" multiple>
            </div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:12px;margin-top:24px;">
        <button class="btn-secondary" onclick="previewReport()">
          <svg style="width:18px;height:18px;display:inline-block;vertical-align:middle;margin-right:6px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
          N√°hled
        </button>
        <button class="btn-primary" onclick="generateReport()">
          <svg style="width:18px;height:18px;display:inline-block;vertical-align:middle;margin-right:6px;stroke:#0a0e11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
          Generovat PDF
        </button>
        <button class="btn-secondary" onclick="emailReport()">
          <svg style="width:18px;height:18px;display:inline-block;vertical-align:middle;margin-right:6px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
            <polyline points="22,6 12,13 2,6"/>
          </svg>
          Odeslat emailem
        </button>
      </div>
      
      <div style="display:flex;gap:12px;margin-top:12px;">
        <button class="btn-secondary" id="btnSaveScheduled" onclick="saveScheduledReport()" style="display:none;">
          <svg style="width:18px;height:18px;display:inline-block;vertical-align:middle;margin-right:6px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
            <polyline points="17 21 17 13 7 13 7 21"/>
            <polyline points="7 3 7 8 15 8"/>
          </svg>
          Ulo≈æit pl√°novan√Ω report
        </button>
      </div>

      <!-- Preview -->
      <div id="reportPreview" style="display:none;margin-top:32px;">
        <div class="report-preview" id="previewContent"></div>
      </div>
    </div>

    <!-- Scheduled Reports -->
    <div class="scheduled-reports" id="scheduledReports" style="display:none;">
      <h2 style="display:flex;align-items:center;gap:8px;">
        <svg style="width:24px;height:24px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        Pl√°novan√© reporty
      </h2>
      <div id="scheduledList"></div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="/" class="nav-item" onclick="event.preventDefault(); if(window.setAppTab) { window.setAppTab('dashboard'); } else { window.location.href='/'; }">
      <div class="nav-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
      <div class="nav-label">Dom≈Ø</div>
    </a>
    <a href="/jobs.html" class="nav-item">
      <div class="nav-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
      <div class="nav-label">Zak√°zky</div>
    </a>
    <a href="/timesheets.html" class="nav-item">
      <div class="nav-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
      <div class="nav-label">V√Ωkazy</div>
    </a>
    <a href="/calendar.html" class="nav-item">
      <div class="nav-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></div>
      <div class="nav-label">Kalend√°≈ô</div>
    </a>
    <a href="#" id="more-menu-btn" class="nav-item" onclick="event.preventDefault(); document.getElementById('more-menu').classList.toggle('show');">
      <div class="nav-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></div>
      <div class="nav-label">V√≠ce</div>
    </a>
    <a href="/settings.html" class="nav-item">
      <div class="nav-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/></svg></div>
      <div class="nav-label">Nastaven√≠</div>
    </a>
  </nav>

  <!-- More Menu (Expandable) -->
  <div id="more-menu" class="more-menu">
    <div class="more-menu-backdrop" onclick="document.getElementById('more-menu').classList.remove('show');"></div>
    <div class="more-menu-panel">
      <div class="more-menu-header">
        <div style="font-size:18px;font-weight:600;color:#e8eef2;">Navigace</div>
        <button onclick="document.getElementById('more-menu').classList.remove('show');" style="background:none;border:none;color:#9ca8b3;cursor:pointer;font-size:24px;line-height:1;width:32px;height:32px;display:flex;align-items:center;justify-content:center;">√ó</button>
      </div>
      <div class="more-menu-content">
        <a href="/" onclick="event.preventDefault(); if(window.setAppTab) window.setAppTab('dashboard'); document.getElementById('more-menu').classList.remove('show');" class="more-menu-item">
          <span>p≈ôehled</span>
        </a>
        <a href="/calendar.html" class="more-menu-item">
          <span>kalend√°≈ô</span>
        </a>
        <a href="/timesheets.html" class="more-menu-item">
          <span>v√Ωkazy hodin</span>
        </a>
        <a href="/jobs.html" class="more-menu-item">
          <span>zak√°zky</span>
        </a>
        <a href="/tasks.html" class="more-menu-item">
          <span>√∫koly</span>
        </a>
        <a href="/employees.html" class="more-menu-item">
          <span>zamƒõstnanci</span>
        </a>
        <a href="/warehouse.html" class="more-menu-item">
          <span>sklad</span>
        </a>
        <a href="/finance.html" class="more-menu-item">
          <span>finance</span>
        </a>
        <a href="/documents.html" class="more-menu-item">
          <span>dokumenty</span>
        </a>
        <a href="/reports.html" class="more-menu-item">
          <span>üìä reporty</span>
        </a>
        <a href="/settings.html" class="more-menu-item">
          <span>nastaven√≠</span>
        </a>
      </div>
    </div>
  </div>

  <script>
    let currentReportType = null;
    let jobs = [];
    let employees = [];
    let timesheets = [];
    let tasks = [];
    let invoices = [];

    // Load data
    async function loadData() {
      try {
        // Load jobs
        const jobsRes = await fetch('/api/jobs');
        const jobsData = await jobsRes.json();
        jobs = jobsData.jobs || [];

        // Load employees
        const empRes = await fetch('/api/employees');
        const empData = await empRes.json();
        employees = empData.employees || [];

        // Load timesheets
        const tsRes = await fetch('/api/timesheets');
        const tsData = await tsRes.json();
        timesheets = tsData.timesheets || [];

        // Load tasks
        const tasksRes = await fetch('/api/tasks');
        const tasksData = await tasksRes.json();
        tasks = tasksData.tasks || [];

        // Load invoices
        const invStored = localStorage.getItem('finance_invoices');
        invoices = invStored ? JSON.parse(invStored) : [];

        populateProjectSelect();
      } catch (e) {
        console.error('Error loading data:', e);
      }
    }

    function populateProjectSelect() {
      const select = document.getElementById('reportProject');
      select.innerHTML = '<option value="">Vyberte projekt</option>';
      jobs.forEach(job => {
        const option = document.createElement('option');
        option.value = job.id;
        option.textContent = job.title || job.name || `Projekt ${job.id}`;
        select.appendChild(option);
      });
    }

    function openReportGenerator(type) {
      currentReportType = type;
      document.getElementById('reportGenerator').classList.add('show');
      document.getElementById('scheduledReports').style.display = 'none';
      
      const titles = {
        weekly: 'T√Ωdenn√≠ report',
        monthly: 'Mƒõs√≠ƒçn√≠ report',
        project: 'Projektov√Ω report'
      };
      document.getElementById('generatorTitle').textContent = titles[type] || 'Generovat report';

      // Set default dates
      const today = new Date();
      const to = today.toISOString().split('T')[0];
      
      if (type === 'weekly') {
        const from = new Date(today);
        from.setDate(today.getDate() - 7);
        document.getElementById('reportDateFrom').value = from.toISOString().split('T')[0];
        document.getElementById('reportDateTo').value = to;
      } else if (type === 'monthly') {
        const from = new Date(today.getFullYear(), today.getMonth(), 1);
        document.getElementById('reportDateFrom').value = from.toISOString().split('T')[0];
        document.getElementById('reportDateTo').value = to;
      }

      // Show/hide project select
      document.getElementById('projectSelectGroup').style.display = type === 'project' ? 'block' : 'none';

      // Setup sections
      setupReportSections(type);
    }

    function setupReportSections(type) {
      const container = document.getElementById('reportSections');
      const sections = {
        weekly: [
          { id: 'hours', label: 'Hodiny celkem', checked: true },
          { id: 'projects', label: 'Rozpad po projektech', checked: true },
          { id: 'employees', label: 'Rozpad po zamƒõstnanc√≠ch', checked: true },
          { id: 'tasks', label: 'Dokonƒçen√© √∫koly', checked: true }
        ],
        monthly: [
          { id: 'finance', label: 'Finanƒçn√≠ p≈ôehled', checked: true },
          { id: 'topProjects', label: 'Top projekty', checked: true },
          { id: 'productivity', label: 'Produktivita t√Ωmu', checked: true },
          { id: 'trends', label: 'Grafy trend≈Ø', checked: true }
        ],
        project: [
          { id: 'timeline', label: 'Timeline prac√≠', checked: true },
          { id: 'costs', label: 'N√°klady vs rozpoƒçet', checked: true },
          { id: 'profitability', label: 'Ziskovost', checked: true },
          { id: 'photos', label: 'Fotodokumentace', checked: false }
        ]
      };

      container.innerHTML = sections[type].map(section => `
        <div class="checkbox-group">
          <input type="checkbox" id="section_${section.id}" ${section.checked ? 'checked' : ''}>
          <label for="section_${section.id}">${section.label}</label>
        </div>
      `).join('');
    }

    function closeGenerator() {
      document.getElementById('reportGenerator').classList.remove('show');
      document.getElementById('reportPreview').style.display = 'none';
    }

    // Schedule options toggle
    document.getElementById('scheduleReport').addEventListener('change', (e) => {
      const show = e.target.checked;
      document.getElementById('scheduleOptions').style.display = show ? 'block' : 'none';
      document.getElementById('btnSaveScheduled').style.display = show ? 'block' : 'none';
    });

    async function previewReport() {
      const dateFrom = document.getElementById('reportDateFrom').value;
      const dateTo = document.getElementById('reportDateTo').value;
      const projectId = document.getElementById('reportProject').value;
      const note = document.getElementById('reportNote').value;

      if (!dateFrom || !dateTo) {
        alert('Vypl≈àte datum od a do');
        return;
      }

      const reportData = await generateReportData(dateFrom, dateTo, projectId);
      const preview = renderReportPreview(reportData, note);
      
      document.getElementById('previewContent').innerHTML = preview;
      document.getElementById('reportPreview').style.display = 'block';
      document.getElementById('reportPreview').scrollIntoView({ behavior: 'smooth' });
    }

    async function generateReportData(dateFrom, dateTo, projectId) {
      const from = new Date(dateFrom);
      const to = new Date(dateTo);
      to.setHours(23, 59, 59);

      const data = {
        type: currentReportType,
        dateFrom: dateFrom,
        dateTo: dateTo,
        projectId: projectId
      };

      // Filter timesheets
      data.timesheets = timesheets.filter(ts => {
        const tsDate = new Date(ts.date);
        return tsDate >= from && tsDate <= to && (!projectId || ts.job_id == projectId);
      });

      // Filter tasks
      data.tasks = tasks.filter(t => {
        if (currentReportType === 'project' && projectId && t.job_id != projectId) return false;
        if (t.status === 'completed') {
          const extended = getTaskExtended(t.id);
          if (extended?.completed_at) {
            const completed = new Date(extended.completed_at);
            return completed >= from && completed <= to;
          }
        }
        return false;
      });

      // Calculate hours
      data.totalHours = data.timesheets.reduce((sum, ts) => sum + (parseFloat(ts.hours) || 0), 0);

      // Hours by project
      data.hoursByProject = {};
      data.timesheets.forEach(ts => {
        const job = jobs.find(j => j.id === ts.job_id);
        const projectName = job ? (job.title || job.name || `Projekt ${job.id}`) : 'Bez projektu';
        data.hoursByProject[projectName] = (data.hoursByProject[projectName] || 0) + (parseFloat(ts.hours) || 0);
      });

      // Hours by employee
      data.hoursByEmployee = {};
      data.timesheets.forEach(ts => {
        const emp = employees.find(e => e.id === ts.employee_id);
        const empName = emp ? (emp.name || `Zamƒõstnanec ${emp.id}`) : 'Nezn√°m√Ω';
        data.hoursByEmployee[empName] = (data.hoursByEmployee[empName] || 0) + (parseFloat(ts.hours) || 0);
      });

      // Financial data (monthly)
      if (currentReportType === 'monthly') {
        data.invoices = invoices.filter(inv => {
          const invDate = new Date(inv.date || inv.created_at);
          return invDate >= from && invDate <= to && inv.status === 'paid';
        });
        data.totalIncome = data.invoices.reduce((sum, inv) => sum + (parseFloat(inv.amount) || 0), 0);
        data.totalCosts = data.totalHours * 300; // Simplified hourly rate
        data.profit = data.totalIncome - data.totalCosts;
        data.margin = data.totalIncome > 0 ? ((data.profit / data.totalIncome) * 100).toFixed(1) : 0;
      }

      // Project data
      if (currentReportType === 'project' && projectId) {
        const project = jobs.find(j => j.id == projectId);
        data.project = project;
        data.projectInvoices = invoices.filter(inv => inv.job_id == projectId && inv.status === 'paid');
        data.projectIncome = data.projectInvoices.reduce((sum, inv) => sum + (parseFloat(inv.amount) || 0), 0);
        data.projectCosts = data.totalHours * 300;
        data.projectProfit = data.projectIncome - data.projectCosts;
        data.projectROI = data.projectCosts > 0 ? ((data.projectProfit / data.projectCosts) * 100).toFixed(1) : 0;
      }

      return data;
    }

    function renderReportPreview(data, note) {
      const sections = [];
      const checkedSections = Array.from(document.querySelectorAll('#reportSections input:checked')).map(cb => cb.id.replace('section_', ''));

      // Header
      let html = `
        <h1>${currentReportType === 'weekly' ? 'T√Ωdenn√≠' : currentReportType === 'monthly' ? 'Mƒõs√≠ƒçn√≠' : 'Projektov√Ω'} Report</h1>
        <div class="report-meta">
          Obdob√≠: ${formatDate(data.dateFrom)} - ${formatDate(data.dateTo)}
          ${data.project ? `<br>Projekt: ${escapeHtml(data.project.title || data.project.name || 'Projekt ' + data.project.id)}` : ''}
        </div>
      `;

      // Weekly sections
      if (currentReportType === 'weekly') {
        if (checkedSections.includes('hours')) {
          html += `
            <div class="report-section">
              <h2>Hodiny celkem</h2>
              <div class="report-stat">
                <div class="label">Celkem hodin</div>
                <div class="value">${data.totalHours.toFixed(1)}h</div>
              </div>
            </div>
          `;
        }

        if (checkedSections.includes('projects')) {
          html += `
            <div class="report-section">
              <h2>Rozpad po projektech</h2>
              <table class="report-table">
                <thead>
                  <tr><th>Projekt</th><th>Hodiny</th><th>%</th></tr>
                </thead>
                <tbody>
                  ${Object.entries(data.hoursByProject).map(([project, hours]) => `
                    <tr>
                      <td>${escapeHtml(project)}</td>
                      <td>${hours.toFixed(1)}h</td>
                      <td>${data.totalHours > 0 ? ((hours / data.totalHours) * 100).toFixed(1) : 0}%</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `;
        }

        if (checkedSections.includes('employees')) {
          html += `
            <div class="report-section">
              <h2>Rozpad po zamƒõstnanc√≠ch</h2>
              <table class="report-table">
                <thead>
                  <tr><th>Zamƒõstnanec</th><th>Hodiny</th><th>%</th></tr>
                </thead>
                <tbody>
                  ${Object.entries(data.hoursByEmployee).map(([emp, hours]) => `
                    <tr>
                      <td>${escapeHtml(emp)}</td>
                      <td>${hours.toFixed(1)}h</td>
                      <td>${data.totalHours > 0 ? ((hours / data.totalHours) * 100).toFixed(1) : 0}%</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `;
        }

        if (checkedSections.includes('tasks')) {
          html += `
            <div class="report-section">
              <h2>Dokonƒçen√© √∫koly</h2>
              <div class="report-stat">
                <div class="label">Celkem dokonƒçeno</div>
                <div class="value">${data.tasks.length}</div>
              </div>
            </div>
          `;
        }
      }

      // Monthly sections
      if (currentReportType === 'monthly') {
        if (checkedSections.includes('finance')) {
          html += `
            <div class="report-section">
              <h2>Finanƒçn√≠ p≈ôehled</h2>
              <div class="report-stat">
                <div class="label">P≈ô√≠jmy</div>
                <div class="value">${formatCurrency(data.totalIncome)}</div>
              </div>
              <div class="report-stat">
                <div class="label">N√°klady</div>
                <div class="value">${formatCurrency(data.totalCosts)}</div>
              </div>
              <div class="report-stat">
                <div class="label">Zisk</div>
                <div class="value">${formatCurrency(data.profit)}</div>
              </div>
              <div class="report-stat">
                <div class="label">Mar≈æe</div>
                <div class="value">${data.margin}%</div>
              </div>
            </div>
          `;
        }
      }

      // Project sections
      if (currentReportType === 'project') {
        if (checkedSections.includes('costs')) {
          html += `
            <div class="report-section">
              <h2>N√°klady vs Rozpoƒçet</h2>
              <div class="report-stat">
                <div class="label">Skuteƒçn√© n√°klady</div>
                <div class="value">${formatCurrency(data.projectCosts)}</div>
              </div>
            </div>
          `;
        }

        if (checkedSections.includes('profitability')) {
          html += `
            <div class="report-section">
              <h2>Ziskovost</h2>
              <div class="report-stat">
                <div class="label">P≈ô√≠jmy</div>
                <div class="value">${formatCurrency(data.projectIncome)}</div>
              </div>
              <div class="report-stat">
                <div class="label">N√°klady</div>
                <div class="value">${formatCurrency(data.projectCosts)}</div>
              </div>
              <div class="report-stat">
                <div class="label">Zisk</div>
                <div class="value">${formatCurrency(data.projectProfit)}</div>
              </div>
              <div class="report-stat">
                <div class="label">ROI</div>
                <div class="value">${data.projectROI}%</div>
              </div>
            </div>
          `;
        }
      }

      if (note) {
        html += `
          <div class="report-section">
            <h2>Pozn√°mka</h2>
            <p>${escapeHtml(note)}</p>
          </div>
        `;
      }

      return html;
    }

    async function generateReport() {
      const dateFrom = document.getElementById('reportDateFrom').value;
      const dateTo = document.getElementById('reportDateTo').value;
      const projectId = document.getElementById('reportProject').value;
      const note = document.getElementById('reportNote').value;

      if (!dateFrom || !dateTo) {
        alert('Vypl≈àte datum od a do');
        return;
      }

      const reportData = await generateReportData(dateFrom, dateTo, projectId);
      const preview = renderReportPreview(reportData, note);

      // Generate PDF using jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      // Add logo placeholder
      doc.setFontSize(20);
      doc.text('green david', 20, 20);
      
      // Convert HTML to PDF (simplified - would need html2canvas or similar)
      doc.setFontSize(16);
      doc.text(`${currentReportType === 'weekly' ? 'T√Ωdenn√≠' : currentReportType === 'monthly' ? 'Mƒõs√≠ƒçn√≠' : 'Projektov√Ω'} Report`, 20, 40);
      doc.setFontSize(12);
      doc.text(`Obdob√≠: ${formatDate(dateFrom)} - ${formatDate(dateTo)}`, 20, 50);
      
      // Add content (simplified)
      let y = 70;
      doc.setFontSize(14);
      doc.text(`Celkem hodin: ${reportData.totalHours.toFixed(1)}h`, 20, y);
      
      // Save PDF
      const filename = `report_${currentReportType}_${dateFrom}_${dateTo}.pdf`;
      doc.save(filename);
      
      alert('PDF report byl vygenerov√°n a sta≈æen!');
    }

    function emailReport() {
      alert('Email distribuce bude implementov√°na (vy≈æaduje backend)');
    }

    function showScheduledReports() {
      document.getElementById('reportGenerator').classList.remove('show');
      document.getElementById('scheduledReports').style.display = 'block';
      loadScheduledReports();
    }

    function loadScheduledReports() {
      const stored = localStorage.getItem('scheduled_reports');
      const scheduled = stored ? JSON.parse(stored) : [];
      
      const container = document.getElementById('scheduledList');
      if (scheduled.length === 0) {
        container.innerHTML = '<p style="color:var(--text-tertiary);text-align:center;padding:40px;">≈Ω√°dn√© pl√°novan√© reporty</p>';
        return;
      }

      container.innerHTML = scheduled.map((item, idx) => `
        <div class="scheduled-item">
          <div class="scheduled-info">
            <h4>${item.type === 'weekly' ? 'T√Ωdenn√≠' : 'Mƒõs√≠ƒçn√≠'} report</h4>
            <p>${item.frequency === 'weekly' ? 'Ka≈æd√Ω p√°tek' : '1. den mƒõs√≠ce'} ‚Ä¢ ${item.email || 'Bez emailu'}</p>
          </div>
          <div class="scheduled-actions">
            <button class="btn-icon" onclick="editScheduled(${idx})" title="Upravit">‚úèÔ∏è</button>
            <button class="btn-icon" onclick="deleteScheduled(${idx})" title="Smazat">üóëÔ∏è</button>
          </div>
        </div>
      `).join('');
    }

    function editScheduled(idx) {
      const stored = localStorage.getItem('scheduled_reports');
      const scheduled = stored ? JSON.parse(stored) : [];
      const item = scheduled[idx];
      if (!item) return;
      
      // Open generator with scheduled data
      openReportGenerator(item.type);
      document.getElementById('scheduleReport').checked = true;
      document.getElementById('scheduleOptions').style.display = 'block';
      document.getElementById('scheduleFrequency').value = item.frequency;
      document.getElementById('scheduleEmail').value = item.email || '';
    }

    function deleteScheduled(idx) {
      if (!confirm('Opravdu smazat pl√°novan√Ω report?')) return;
      const stored = localStorage.getItem('scheduled_reports');
      const scheduled = stored ? JSON.parse(stored) : [];
      scheduled.splice(idx, 1);
      localStorage.setItem('scheduled_reports', JSON.stringify(scheduled));
      loadScheduledReports();
    }

    function saveScheduledReport() {
      if (!document.getElementById('scheduleReport').checked) return;
      
      const frequency = document.getElementById('scheduleFrequency').value;
      const email = document.getElementById('scheduleEmail').value;
      
      if (!email) {
        alert('Zadejte email pro distribuci');
        return;
      }

      const stored = localStorage.getItem('scheduled_reports');
      const scheduled = stored ? JSON.parse(stored) : [];
      
      scheduled.push({
        type: currentReportType,
        frequency: frequency,
        email: email,
        created_at: new Date().toISOString()
      });
      
      localStorage.setItem('scheduled_reports', JSON.stringify(scheduled));
      alert('Pl√°novan√Ω report byl ulo≈æen!');
    }

    function getTaskExtended(taskId) {
      const key = `task_extended_${taskId}`;
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : null;
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('cs-CZ');
    }

    function formatCurrency(amount) {
      return new Intl.NumberFormat('cs-CZ', { style: 'currency', currency: 'CZK' }).format(amount);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Initialize
    loadData();
  </script>
  <div id="bottom-nav-container"></div>
  <script src="/static/bottom-nav.js"></script>
  <link rel="stylesheet" href="/static/icons.css">
</body>
</html>

