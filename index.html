<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green David App - Dashboard</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-top">
            <div class="logo-area">
                <div class="logo-icon">
                    <img src="/logo.jpg" alt="Green David" onerror="this.innerHTML='GD'">
                </div>
                <div class="app-title">green david</div>
            </div>
            <div class="profile-btn" onclick="showProfile()">
                <svg viewBox="0 0 24 24">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </div>
        </div>
        
        <div class="user-info">
            <div class="user-left">
                <div class="user-name" id="user-name">Naƒç√≠t√°n√≠...</div>
                <div class="user-role" id="user-role">...</div>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="stat-jobs">-</div>
                    <div class="stat-label">zak√°zky</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="stat-team">-</div>
                    <div class="stat-label">t√Ωm</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="stat-tasks">-</div>
                    <div class="stat-label">√∫koly</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
        <div class="action-card" onclick="location.href='/jobs?action=new'">
            <div class="action-icon icon-mint">
                <svg viewBox="0 0 24 24">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </div>
            <div>
                <div class="action-title">Nov√° zak√°zka</div>
                <div class="action-subtitle">Vytvo≈ôit</div>
            </div>
        </div>
        
        <div class="action-card" onclick="location.href='/timesheets?action=new'">
            <div class="action-icon icon-gray">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
            </div>
            <div>
                <div class="action-title">V√Ωkaz hodin</div>
                <div class="action-subtitle">P≈ôidat ƒças</div>
            </div>
        </div>
        
        <div class="action-card" onclick="location.href='/employees'">
            <div class="action-icon icon-mint">
                <svg viewBox="0 0 24 24">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </div>
            <div>
                <div class="action-title">T√Ωm</div>
                <div class="action-subtitle">Spravovat</div>
            </div>
        </div>
        
        <div class="action-card" onclick="location.href='/stats'">
            <div class="action-icon icon-gray">
                <svg viewBox="0 0 24 24">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
            </div>
            <div>
                <div class="action-title">Statistiky</div>
                <div class="action-subtitle">P≈ôehledy</div>
            </div>
        </div>
    </div>
    
    <!-- Active Jobs Section -->
    <div class="section">
        <div class="section-header">
            <div class="section-title">Aktivn√≠ zak√°zky</div>
            <div class="see-all" onclick="location.href='/jobs'">V≈°e ‚Ä∫</div>
        </div>
        
        <div id="active-jobs-list">
            <!-- Loading -->
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="tab-bar">
        <div class="tab-item active" onclick="location.href='/'">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </div>
            <div class="tab-label">dom≈Ø</div>
        </div>
        
        <div class="tab-item" onclick="location.href='/jobs'">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                </svg>
            </div>
            <div class="tab-label">zak√°zky</div>
        </div>
        
        <div class="tab-item" onclick="location.href='/timesheets'">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
            </div>
            <div class="tab-label">v√Ωkazy</div>
        </div>
        
        <div class="tab-item" onclick="location.href='/calendar'">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
            </div>
            <div class="tab-label">kalend√°≈ô</div>
        </div>
        
        <div class="tab-item" onclick="showMore()">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m4.22-13.22l-2.83 2.83m0 4.24l2.83 2.83m1.39-9.9l-2.83 2.83m-8.5 0l-2.83-2.83m2.83 11.73l-2.83 2.83m8.5 0l2.83-2.83"></path>
                </svg>
            </div>
            <div class="tab-label">v√≠ce</div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script>
        // API Helper
        async function api(path, opts = {}) {
            const res = await fetch(path, {
                credentials: 'same-origin',
                headers: { 'Content-Type': 'application/json' },
                ...opts
            });
            if (!res.ok) {
                let msg = res.statusText;
                try {
                    const j = await res.json();
                    msg = j.error || msg;
                } catch {}
                throw new Error(msg);
            }
            try {
                return await res.json();
            } catch {
                return {};
            }
        }
        
        // Load user info
        async function loadUserInfo() {
            try {
                const data = await api('/api/me');
                if (data.authenticated && data.user) {
                    document.getElementById('user-name').textContent = data.user.name;
                    document.getElementById('user-role').textContent = data.user.role;
                    document.getElementById('stat-tasks').textContent = data.tasks_count || 0;
                } else {
                    // Redirect to login
                    location.href = '/login';
                }
            } catch (error) {
                console.error('Error loading user:', error);
            }
        }
        
        // Load stats
        async function loadStats() {
            try {
                // Jobs count
                const jobs = await api('/api/jobs');
                document.getElementById('stat-jobs').textContent = jobs.jobs?.length || 0;
                
                // Team count
                const employees = await api('/api/employees');
                document.getElementById('stat-team').textContent = employees.employees?.length || 0;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        // Load active jobs
        async function loadActiveJobs() {
            const container = document.getElementById('active-jobs-list');
            try {
                const data = await api('/api/jobs');
                const jobs = data.jobs || [];
                
                if (jobs.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìã</div>
                            <div class="empty-title">≈Ω√°dn√© aktivn√≠ zak√°zky</div>
                            <div class="empty-text">Vytvo≈ôte prvn√≠ zak√°zku pomoc√≠ tlaƒç√≠tka v√Ω≈°e</div>
                        </div>
                    `;
                    return;
                }
                
                // Show first 5 jobs
                const html = jobs.slice(0, 5).map(job => {
                    const status = job.status || 'Pl√°n';
                    const badgeClass = status.toLowerCase().includes('aktivn√≠') ? 'badge-active' : 'badge-plan';
                    
                    return `
                        <div class="card list-card" onclick="location.href='/jobs/${job.id}'">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                            </div>
                            <div class="card-content">
                                <div class="card-title">${job.title || job.name || 'Bez n√°zvu'}</div>
                                <div class="card-subtitle">${job.city || '-'} ‚Ä¢ ${job.date || '-'}</div>
                            </div>
                            <div class="card-badge ${badgeClass}">${status}</div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading jobs:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <div class="empty-title">Chyba p≈ôi naƒç√≠t√°n√≠</div>
                        <div class="empty-text">${error.message}</div>
                    </div>
                `;
            }
        }
        
        // Show profile
        function showProfile() {
            // TODO: Show profile modal
            alert('Profil - TODO');
        }
        
        // Show more menu
        function showMore() {
            // TODO: Show more menu modal
            alert('V√≠ce mo≈ænost√≠ - TODO');
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadUserInfo();
            loadStats();
            loadActiveJobs();
        });
    </script>
</body>
</html>
