
<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>green david app</title>
    <link rel="stylesheet" href="/style.css"/>
    <style>
      /* Bottom dock for the login box (#userbox) – non-destructive */
      #userbox-dock{ display:none; justify-content:center; margin:12px 0 0 0; }
      #userbox{
        background:#1f262b; color:#eaf6ef;
        border:1px solid #445058; border-radius:14px;
        padding:8px 12px; display:inline-flex; gap:10px; align-items:center;
      }
      #userbox .ghost, #userbox button, #userbox a{
        background:transparent; color:#eaf6ef; border:1px solid #607d8b55;
        border-radius:10px; padding:6px 10px; text-decoration:none; cursor:pointer;
      }
      @media (max-width:560px){
        #userbox-dock{ padding:0 12px; }
        #userbox{ width:100%; justify-content:space-between; flex-wrap:wrap; row-gap:6px; }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="brand">
        <img src="/logo.jpg" alt="Green David" class="brand-logo" onerror="this.src='/logo.svg'"/>
        <div>
          <div class="brand-title">green david app</div>
          <div class="brand-sub">interní systém</div>
        </div>
        <div class="right small" id="userbox"></div>
      </div>
    </header>

    <main class="container">
      <div id="app"></div>
      <div id="js-error" class="error-overlay" style="display:none"></div>
      <p class="small footer">© green david s.r.o.</p>
      <!-- userbox will be moved here by the script below -->
      <div id="userbox-dock" aria-hidden="true"></div>
    </main>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
      function showJSError(msg){
        var el = document.getElementById('js-error');
        el.style.display = 'block';
        el.textContent = String(msg || 'Neznámá chyba ve skriptu.');
        console.error(msg);
      }
      window.addEventListener('error', function(e){ showJSError(e.error ? (e.error.stack||e.error) : (e.message||e)); });
      window.addEventListener('unhandledrejection', function(e){ showJSError(e.reason ? (e.reason.stack||e.reason) : e); });

      async function api(path, opts={}){
        const res = await fetch(path, {credentials:"same-origin", headers:{"Content-Type":"application/json"}, ...opts});
        if(!res.ok){ let msg = res.statusText; try{ const j = await res.json(); msg = j.error || msg; }catch{} throw new Error(msg); }
        try{ return await res.json(); }catch{return {};}
      }
      async function refreshUserBox(){
        const box = document.getElementById("userbox");
        if(!box) return;
        try{
          const j = await api("/api/me");
          if(j.authenticated){
            box.innerHTML = `Přihlášen: <b>${j.user.name}</b> (${j.user.role}) • Úkoly: <b>${j.tasks_count}</b> &nbsp; <button class="ghost" id="logout-btn">Odhlásit</button>`;
            const btn = document.getElementById("logout-btn");
            if(btn) btn.onclick = async ()=>{ await api("/api/logout",{method:"POST"}); location.reload(); };
          } else {
            box.innerHTML = '<span>Nepřihlášen</span>';
          }
        }catch(e){ box.textContent = ""; }
      }

      // === Move userbox under the footer and populate it ===
      (function(){
        function dockAndRefresh(){
          var box = document.getElementById('userbox');
          var dock = document.getElementById('userbox-dock');
          var footer = document.querySelector('main .footer');
          if(!box || !dock || !footer) return;
          if(!dock.contains(box)){
            footer.parentNode.insertBefore(dock, footer.nextSibling);
            dock.appendChild(box);
          }
          dock.style.display = 'flex';
          dock.setAttribute('aria-hidden','false');
          refreshUserBox();
        }
        if(document.readyState === 'loading'){
          document.addEventListener('DOMContentLoaded', dockAndRefresh);
        } else {
          dockAndRefresh();
        }
      })();
    </script>

    <!-- React app bootstrap kept as-is (omitted here for brevity) -->
  </body>
</html>
