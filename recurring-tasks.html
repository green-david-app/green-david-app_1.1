<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Opakuj√≠c√≠ se √∫koly | Green David</title>
    <link rel="stylesheet" href="/static/style.css"/>
    <link rel="stylesheet" href="/static/css/app.css"/>
    <style>
        :root { --bg-primary: #0a0e11; --bg-card: #151a1e; --border-primary: #2d3439;
                --text-primary: #e8eef2; --text-secondary: #9ca8b3; --mint: #9FD4A1; }
        body { background: var(--bg-primary); color: var(--text-primary); margin: 0; 
               font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .container { padding: 20px; max-width: 1400px; margin: 0 auto; }
        
        .template-card { background: var(--bg-card); border: 1px solid var(--border-primary); border-radius: 12px; 
                        padding: 20px; margin-bottom: 16px; }
        .template-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .template-title { font-size: 18px; font-weight: 700; }
        .frequency-badge { padding: 6px 12px; background: rgba(96, 165, 250, 0.15); color: #60a5fa; 
                          border-radius: 6px; font-size: 12px; font-weight: 600; }
        .template-meta { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; 
                        margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-primary); }
        .meta-item { font-size: 13px; }
        .meta-label { color: var(--text-secondary); font-size: 11px; margin-bottom: 4px; }
        .meta-value { font-weight: 600; }
        
        button { padding: 10px 20px; background: var(--mint); color: #0a0e11; border: none; 
                border-radius: 8px; font-weight: 600; cursor: pointer; }
        button:hover { opacity: 0.9; }
        button.secondary { background: var(--bg-card); border: 1px solid var(--border-primary); 
                          color: var(--text-primary); }
    </style>
</head>
<body>
    <header style="background: var(--bg-card); border-bottom: 1px solid var(--border-primary); padding: 16px 20px;">
        <div style="display: flex; align-items: center; gap: 16px;">
            <a href="javascript:history.back()" style="padding: 8px 12px; background: var(--bg-card); border: 1px solid var(--border-primary); border-radius: 8px; text-decoration: none; color: var(--text-primary); font-weight: 600;">‚Üê Zpƒõt</a>
            <h1 style="margin: 0; font-size: 20px; font-weight: 700;">üîÑ Opakuj√≠c√≠ se √∫koly</h1>
            <button onclick="generateTasks()" style="margin-left: auto;">‚ö° Generovat √∫koly</button>
            <button onclick="showCreateModal()">+ Nov√Ω template</button>
        </div>
    </header>

    <div class="container">
        <div style="background: rgba(96, 165, 250, 0.1); border-left: 4px solid #60a5fa; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
            <div style="font-weight: 700; margin-bottom: 8px;">üí° Co jsou recurring tasks?</div>
            <div style="font-size: 14px; color: var(--text-secondary);">
                Vytvo≈ô ≈°ablony pro pravideln√© √∫koly (sek√°n√≠, √∫dr≈æba, pro≈ôez) a syst√©m automaticky generuje √∫koly podle nastaven√©ho rozvrhu.
            </div>
        </div>

        <div id="templatesList">
            <div style="text-align: center; padding: 60px; color: var(--text-secondary);">Naƒç√≠t√°m templates...</div>
        </div>
    </div>

    <script>
        async function loadTemplates() {
            try {
                const response = await fetch('/api/recurring/templates');
                const data = await response.json();
                
                if (data.success) {
                    renderTemplates(data.templates);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function renderTemplates(templates) {
            if (templates.length === 0) {
                document.getElementById('templatesList').innerHTML = 
                    '<div style="text-align: center; padding: 60px; color: var(--text-secondary);">≈Ω√°dn√© recurring tasks. Vytvo≈ô prvn√≠ template!</div>';
                return;
            }

            let html = '';
            templates.forEach(t => {
                const freqText = {
                    'daily': 'Dennƒõ',
                    'weekly': 'T√Ωdnƒõ',
                    'biweekly': 'Ka≈æd√© 2 t√Ωdny',
                    'monthly': 'Mƒõs√≠ƒçnƒõ'
                }[t.frequency] || t.frequency;

                html += `<div class="template-card">`;
                html += `<div class="template-header">`;
                html += `<div><div class="template-title">${t.title}</div>`;
                if (t.job_name) html += `<div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">üìã ${t.job_name}</div>`;
                html += `</div>`;
                html += `<span class="frequency-badge">${freqText}</span>`;
                html += `</div>`;
                if (t.description) html += `<div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">${t.description}</div>`;
                html += `<div class="template-meta">`;
                html += `<div class="meta-item"><div class="meta-label">START</div><div class="meta-value">${t.start_date}</div></div>`;
                if (t.assigned_name) html += `<div class="meta-item"><div class="meta-label">P≈òI≈òAZENO</div><div class="meta-value">${t.assigned_name}</div></div>`;
                if (t.estimated_hours) html += `<div class="meta-item"><div class="meta-label">ƒåAS</div><div class="meta-value">${t.estimated_hours}h</div></div>`;
                html += `</div>`;
                html += `<div style="display: flex; gap: 12px; margin-top: 16px;">`;
                html += `<button class="secondary" onclick="editTemplate(${t.id})">‚úèÔ∏è Upravit</button>`;
                html += `<button class="secondary" onclick="deleteTemplate(${t.id})" style="color: #ff6b6b;">üóëÔ∏è Smazat</button>`;
                html += `</div>`;
                html += `</div>`;
            });

            document.getElementById('templatesList').innerHTML = html;
        }

        async function generateTasks() {
            if (!confirm('Vygenerovat nov√© √∫koly podle templates?')) return;
            
            try {
                const response = await fetch('/api/recurring/generate', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    alert(`‚úì Vygenerov√°no ${data.generated} √∫kol≈Ø!`);
                    window.location.href = '/tasks.html';
                }
            } catch (error) {
                alert('Chyba: ' + error);
            }
        }

        function showCreateModal() { alert('Create modal - TODO'); }
        function editTemplate(id) { alert('Edit template ' + id); }
        function deleteTemplate(id) { alert('Delete template ' + id); }

        loadTemplates();
    </script>
</body>
</html>
