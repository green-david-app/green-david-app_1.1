<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dokumenty - green david app</title>
  <link rel="stylesheet" href="/static/style.css"/>
  <link rel="stylesheet" href="/static/css/app.css"/>
  <link rel="stylesheet" href="/static/css/glass-design.css"/>
  <link rel="stylesheet" href="/static/css/tasks-design-system.css"/>
  <script src="/app-settings.js"></script>
    <link rel="stylesheet" href="/static/css/sidebar.css"/>
    <link rel="stylesheet" href="/static/css/responsive.css"/>
</head>
<body class="has-sidebar">
  <div id="app-header"></div>

  <div class="documents-page">
      <h1 style="display:flex; align-items:center; gap:14px; font-size:24px; font-weight:600;">
        <div class="page-icon orange">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
        </div>
        Dokumenty
      </h1>
      <div class="header-actions">
        <button class="btn-secondary" onclick="clearTrash()">
          <svg style="width:18px;height:18px;display:inline-block;vertical-align:middle;margin-right:6px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
          </svg>
          Vysypat ko≈°
        </button>
        <button class="btn-primary" onclick="document.getElementById('fileInput').click()">+ Nahr√°t soubor</button>
      </div>
    </div>

    <!-- File Browser -->
    <div class="file-browser">
      <!-- Sidebar -->
      <div class="sidebar">
        <h3>Kategorie</h3>
        <div class="folder active" data-folder="all" onclick="switchFolder('all')">
          <svg style="width:18px;height:18px;stroke:#B2FBA5;display:inline-block;vertical-align:middle;margin-right:6px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
          V≈°echny soubory
        </div>
        <div class="folder" data-folder="projects" onclick="switchFolder('projects')">
          <svg style="width:18px;height:18px;stroke:#B2FBA5;display:inline-block;vertical-align:middle;margin-right:6px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
          </svg>
          Projekty
        </div>
        <div class="folder" data-folder="contracts" onclick="switchFolder('contracts')">
          <svg style="width:18px;height:18px;stroke:#B2FBA5;display:inline-block;vertical-align:middle;margin-right:6px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
          </svg>
          Smlouvy
        </div>
        <div class="folder" data-folder="invoices" onclick="switchFolder('invoices')">
          <svg style="width:18px;height:18px;stroke:#B2FBA5;display:inline-block;vertical-align:middle;margin-right:6px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
          </svg>
          Faktury
        </div>
        <div class="folder" data-folder="photos" onclick="switchFolder('photos')">
          <svg style="width:18px;height:18px;stroke:#B2FBA5;display:inline-block;vertical-align:middle;margin-right:6px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
          </svg>
          Fotky
        </div>
        <div class="folder" data-folder="trash" onclick="switchFolder('trash')">
          <svg style="width:18px;height:18px;stroke:#B2FBA5;display:inline-block;vertical-align:middle;margin-right:6px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
          </svg>
          Ko≈°
        </div>
      </div>

      <!-- Files Section -->
      <div class="files-section">
        <div class="files-toolbar">
          <div class="search-box">
            <input type="search" id="fileSearch" placeholder="Hledat soubory...">
          </div>
          <div class="view-toggle">
            <button class="view-btn active" data-view="grid" onclick="switchView('grid')" title="Grid">
              <svg style="width:20px;height:20px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
              </svg>
            </button>
            <button class="view-btn" data-view="list" onclick="switchView('list')" title="Seznam">
              <svg style="width:20px;height:20px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="8" y1="6" x2="21" y2="6"/>
                <line x1="8" y1="12" x2="21" y2="12"/>
                <line x1="8" y1="18" x2="21" y2="18"/>
                <line x1="3" y1="6" x2="3.01" y2="6"/>
                <line x1="3" y1="12" x2="3.01" y2="12"/>
                <line x1="3" y1="18" x2="3.01" y2="18"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Upload Area -->
        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
          <div class="upload-icon">üì§</div>
          <div class="upload-text">P≈ôet√°hni soubory sem nebo klikni pro v√Ωbƒõr</div>
          <input type="file" id="fileInput" multiple onchange="handleFileSelect(event)">
        </div>

        <!-- Files Grid -->
        <div id="filesContainer">
          <div class="files-grid" id="filesGrid">
            <!-- Files will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div class="preview-modal" id="previewModal">
    <div class="preview-content" id="previewContent">
      <button class="preview-close" onclick="closePreview()">√ó</button>
    </div>
  </div>

  <!-- File Detail Modal -->
  <div class="file-modal" id="fileModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Detail souboru</h2>
        <button class="close-modal" onclick="closeFileModal()">√ó</button>
      </div>
      <div class="modal-body" style="padding:20px;" id="modalBody">
        <!-- Content will be loaded here -->
      </div>
      <div style="display:flex;justify-content:flex-end;gap:12px;padding:20px;border-top:1px solid var(--border-primary);">
        <button class="btn-secondary" onclick="window.closeFileModal()">Zav≈ô√≠t</button>
        <button class="btn-primary" id="btnSaveFile" onclick="saveFileDetails()">Ulo≈æit</button>
      </div>
    </div>
  </div>


  <!-- More Menu (Expandable) -->
  <div id="more-menu" class="more-menu">
    <div class="more-menu-backdrop" onclick="document.getElementById('more-menu').classList.remove('show');"></div>
    <div class="more-menu-panel">
      <div class="more-menu-header">
        <div style="font-size:18px;font-weight:600;color:#e8eef2;">Navigace</div>
        <button onclick="document.getElementById('more-menu').classList.remove('show');" style="background:none;border:none;color:#9ca8b3;cursor:pointer;font-size:24px;line-height:1;width:32px;height:32px;display:flex;align-items:center;justify-content:center;">√ó</button>
      </div>
      <div class="more-menu-content">
        <a href="/" onclick="event.preventDefault(); if(window.setAppTab) window.setAppTab('dashboard'); document.getElementById('more-menu').classList.remove('show');" class="more-menu-item">
          <span>p≈ôehled</span>
        </a>
        <a href="/calendar.html" class="more-menu-item">
          <span>kalend√°≈ô</span>
        </a>
        <a href="/timesheets.html" class="more-menu-item">
          <span>v√Ωkazy hodin</span>
        </a>
        <a href="/jobs.html" class="more-menu-item">
          <span>zak√°zky</span>
        </a>
        <a href="/tasks.html" class="more-menu-item">
          <span>√∫koly</span>
        </a>
        <a href="/employees.html" class="more-menu-item">
          <span>team</span>
        </a>
        <a href="/warehouse.html" class="more-menu-item">
          <span>sklad</span>
        </a>
        <a href="/finance.html" class="more-menu-item">
          <span>finance</span>
        </a>
        <a href="/documents.html" class="more-menu-item">
          <span>dokumenty</span>
        </a>
        <a href="/reports.html" class="more-menu-item">
          <span>reporty</span>
        </a>
        <a href="/settings.html" class="more-menu-item">
          <span>nastaven√≠</span>
        </a>
      </div>
    </div>
  </div>

  <script>
    let files = [];
    let currentFolder = 'all';
    let currentView = 'grid';
    let currentFileId = null;

    // Load files
    function loadFiles() {
      const stored = localStorage.getItem('documents_files');
      files = stored ? JSON.parse(stored) : [];
      
      // Clean up old trash (30 days)
      const now = new Date();
      files = files.filter(file => {
        if (file.folder === 'trash' && file.deleted_at) {
          const deleted = new Date(file.deleted_at);
          const daysDiff = (now - deleted) / (1000 * 60 * 60 * 24);
          return daysDiff < 30;
        }
        return true;
      });
      
      saveFiles();
      renderFiles();
    }

    function saveFiles() {
      localStorage.setItem('documents_files', JSON.stringify(files));
    }

    function switchFolder(folder) {
      currentFolder = folder;
      document.querySelectorAll('.folder').forEach(f => f.classList.remove('active'));
      document.querySelector(`[data-folder="${folder}"]`).classList.add('active');
      renderFiles();
    }

    function switchView(view) {
      currentView = view;
      document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`[data-view="${view}"]`).classList.add('active');
      renderFiles();
    }

    function renderFiles() {
      const container = document.getElementById('filesContainer');
      const grid = document.getElementById('filesGrid');
      
      let filtered = files.filter(file => {
        if (currentFolder === 'trash') {
          return file.folder === 'trash';
        }
        if (currentFolder !== 'all') {
          return file.folder === currentFolder && file.folder !== 'trash';
        }
        return file.folder !== 'trash';
      });

      const search = document.getElementById('fileSearch').value.toLowerCase();
      if (search) {
        filtered = filtered.filter(file => 
          (file.name || '').toLowerCase().includes(search) ||
          (file.tags || []).some(tag => tag.toLowerCase().includes(search))
        );
      }

      if (filtered.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="icon"><svg style="width:48px;height:48px;stroke:#B2FBA5;opacity:0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><div>≈Ω√°dn√© soubory</div></div>';
        return;
      }

      if (currentView === 'grid') {
        grid.style.display = 'grid';
        grid.innerHTML = filtered.map(file => createFileCard(file)).join('');
      } else {
        grid.style.display = 'none';
        container.innerHTML = '<div class="files-list">' + filtered.map(file => createFileListItem(file)).join('') + '</div>';
      }

      // Attach event listeners
      filtered.forEach(file => {
        const card = document.querySelector(`[data-file-id="${file.id}"]`);
        if (card) {
          card.addEventListener('dblclick', () => openFilePreview(file));
        }
      });
    }

    function createFileCard(file) {
      const icon = getFileIcon(file.name, file.type);
      const size = formatFileSize(file.size || 0);
      const date = formatDate(file.created_at || file.uploaded_at);
      const tags = (file.tags || []).map(tag => `<span class="tag">${escapeHtml(tag)}</span>`).join('');

      return `
        <div class="file-card" data-file-id="${file.id}" onclick="window.openFileDetail(${file.id})">
          <div class="file-actions">
            <button class="file-action-btn" onclick="event.stopPropagation(); window.openFilePreview(${file.id})" title="N√°hled">
              <svg style="width:18px;height:18px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
            <button class="file-action-btn" onclick="event.stopPropagation(); window.shareFile(${file.id})" title="Sd√≠let">
              <svg style="width:18px;height:18px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
              </svg>
            </button>
            <button class="file-action-btn" onclick="event.stopPropagation(); window.deleteFile(${file.id})" title="Smazat">
              <svg style="width:18px;height:18px;stroke:#f87171" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
              </svg>
            </button>
          </div>
          <div class="file-icon">${icon}</div>
          <h4>${escapeHtml(file.name)}</h4>
          <p>${size} ‚Ä¢ ${date}</p>
          ${tags ? `<div class="file-tags">${tags}</div>` : ''}
        </div>
      `;
    }

    function createFileListItem(file) {
      const icon = getFileIcon(file.name, file.type);
      const size = formatFileSize(file.size || 0);
      const date = formatDate(file.created_at || file.uploaded_at);

      return `
        <div class="file-list-item" data-file-id="${file.id}" onclick="window.openFileDetail(${file.id})" ondblclick="window.openFilePreview(${file.id})">
          <div class="file-list-icon">${icon}</div>
          <div>
            <div style="font-weight:600;color:var(--text-primary);">${escapeHtml(file.name)}</div>
            <div style="font-size:11px;color:var(--text-secondary);">${(file.tags || []).join(', ')}</div>
          </div>
          <div style="color:var(--text-secondary);font-size:12px;">${size}</div>
          <div style="color:var(--text-secondary);font-size:12px;">${date}</div>
          <div style="display:flex;gap:4px;">
            <button class="file-action-btn" onclick="event.stopPropagation(); window.openFilePreview(${file.id})" title="N√°hled">
              <svg style="width:18px;height:18px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
            <button class="file-action-btn" onclick="event.stopPropagation(); window.shareFile(${file.id})" title="Sd√≠let">
              <svg style="width:18px;height:18px;stroke:#B2FBA5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
              </svg>
            </button>
            <button class="file-action-btn" onclick="event.stopPropagation(); window.deleteFile(${file.id})" title="Smazat">
              <svg style="width:18px;height:18px;stroke:#f87171" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
              </svg>
            </button>
          </div>
        </div>
      `;
    }

    function getFileIcon(filename, type) {
      const ext = filename.split('.').pop()?.toLowerCase();
      const svgStyle = 'style="width:24px;height:24px;stroke:#B2FBA5;display:inline-block;vertical-align:middle;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"';
      
      if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext) || (type && type.startsWith('image/'))) {
        return `<svg ${svgStyle}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>`;
      }
      if (['pdf'].includes(ext) || (type && type.startsWith('application/pdf'))) {
        return `<svg ${svgStyle}><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>`;
      }
      if (['doc', 'docx'].includes(ext)) {
        return `<svg ${svgStyle}><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>`;
      }
      if (['xls', 'xlsx'].includes(ext)) {
        return `<svg ${svgStyle}><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>`;
      }
      if (['zip', 'rar', '7z'].includes(ext)) {
        return `<svg ${svgStyle}><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg>`;
      }
      return `<svg ${svgStyle}><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>`;
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    function formatDate(dateString) {
      if (!dateString) return '‚Äî';
      const date = new Date(dateString);
      const now = new Date();
      const diff = now - date;
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      
      if (days === 0) return 'Dnes';
      if (days === 1) return 'Vƒçera';
      if (days < 7) return `P≈ôed ${days} dny`;
      return date.toLocaleDateString('cs-CZ');
    }

    async function handleFileSelect(event) {
      const fileList = event.target.files;
      await uploadFiles(Array.from(fileList));
      event.target.value = ''; // Reset input
    }

    async function uploadFiles(fileList) {
      for (const file of fileList) {
        const fileData = {
          id: Date.now() + Math.random(),
          name: file.name,
          type: file.type,
          size: file.size,
          folder: currentFolder === 'trash' ? 'all' : currentFolder,
          tags: [],
          uploaded_at: new Date().toISOString(),
          versions: [{
            version: 1,
            date: new Date().toISOString(),
            size: file.size
          }]
        };

        // Read file as data URL for preview
        const reader = new FileReader();
        reader.onload = (e) => {
          fileData.dataUrl = e.target.result;
          files.push(fileData);
          saveFiles();
          renderFiles();
        };
        reader.readAsDataURL(file);
      }
    }

    window.openFilePreview = function(fileId) {
      const file = typeof fileId === 'object' ? fileId : files.find(f => f.id === fileId);
      if (!file) return;

      const modal = document.getElementById('previewModal');
      const content = document.getElementById('previewContent');
      
      if (file.type && file.type.startsWith('image/')) {
        content.innerHTML = `<button class="preview-close" onclick="closePreview()">√ó</button><img src="${file.dataUrl || '#'}" alt="${escapeHtml(file.name)}">`;
      } else if (file.name.endsWith('.pdf')) {
        content.innerHTML = `<button class="preview-close" onclick="closePreview()">√ó</button><iframe src="${file.dataUrl || '#'}" style="width:100%;height:90vh;border:none;"></iframe>`;
      } else {
        alert('N√°hled nen√≠ k dispozici pro tento typ souboru');
        return;
      }
      
      modal.classList.add('show');
    }

    function closePreview() {
      document.getElementById('previewModal').classList.remove('show');
    }

    window.openFileDetail = function(fileId) {
      currentFileId = fileId;
      const file = files.find(f => f.id === fileId);
      if (!file) return;

      document.getElementById('modalTitle').textContent = file.name;
      document.getElementById('modalBody').innerHTML = renderFileDetail(file);
      document.getElementById('fileModal').classList.add('show');
    }

    function renderFileDetail(file) {
      const shareLink = file.shareLink || generateShareLink(file.id);
      const versions = file.versions || [];

      return `
        <div class="form-group">
          <label>N√°zev souboru</label>
          <input type="text" id="fileName" value="${escapeHtml(file.name)}">
        </div>
        <div class="form-group">
          <label>Kategorie</label>
          <select id="fileFolder">
            <option value="all" ${file.folder === 'all' ? 'selected' : ''}>V≈°echny soubory</option>
            <option value="projects" ${file.folder === 'projects' ? 'selected' : ''}>Projekty</option>
            <option value="contracts" ${file.folder === 'contracts' ? 'selected' : ''}>Smlouvy</option>
            <option value="invoices" ${file.folder === 'invoices' ? 'selected' : ''}>Faktury</option>
            <option value="photos" ${file.folder === 'photos' ? 'selected' : ''}>Fotky</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tagy (oddƒõlen√© ƒç√°rkou)</label>
          <input type="text" id="fileTags" value="${escapeHtml((file.tags || []).join(', '))}" placeholder="Smlouva, T≈ôebonice">
        </div>
        <div class="form-group">
          <label>Sd√≠lec√≠ odkaz</label>
          <div class="share-link">
            <input type="text" id="shareLinkInput" value="${shareLink}" readonly>
            <button onclick="copyShareLink()">Kop√≠rovat</button>
          </div>
        </div>
        <div class="form-group">
          <label>Verze</label>
          <div class="versions-list">
            ${versions.map((v, idx) => `
              <div class="version-item">
                <div class="version-info">
                  Verze ${v.version} ‚Ä¢ ${formatFileSize(v.size)} ‚Ä¢ ${formatDate(v.date)}
                </div>
                <div class="version-actions">
                  ${idx === versions.length - 1 ? '<button class="btn-secondary" style="padding:4px 8px;font-size:11px;">Aktu√°ln√≠</button>' : ''}
                </div>
              </div>
            `).join('')}
          </div>
          <button class="btn-secondary" onclick="document.getElementById('fileInput').click()" style="margin-top:8px;">+ Nahr√°t novou verzi</button>
        </div>
      `;
    }

    function saveFileDetails() {
      const file = files.find(f => f.id === currentFileId);
      if (!file) return;

      file.name = document.getElementById('fileName').value.trim();
      file.folder = document.getElementById('fileFolder').value;
      const tagsInput = document.getElementById('fileTags').value.trim();
      file.tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];

      saveFiles();
      renderFiles();
      closeFileModal();
    }

    window.shareFile = function(fileId) {
      const file = files.find(f => f.id === fileId);
      if (!file) return;

      const shareLink = file.shareLink || generateShareLink(fileId);
      file.shareLink = shareLink;
      saveFiles();

      navigator.clipboard.writeText(shareLink).then(() => {
        alert('Sd√≠lec√≠ odkaz zkop√≠rov√°n do schr√°nky!');
      }).catch(() => {
        prompt('Zkop√≠ruj tento odkaz:', shareLink);
      });
    }

    function copyShareLink() {
      const input = document.getElementById('shareLinkInput');
      input.select();
      document.execCommand('copy');
      alert('Odkaz zkop√≠rov√°n!');
    }

    function generateShareLink(fileId) {
      return `${window.location.origin}/documents.html?share=${fileId}`;
    }

    function deleteFile(fileId) {
      if (!confirm('Opravdu smazat tento soubor?')) return;

      const file = files.find(f => f.id === fileId);
      if (file) {
        if (currentFolder === 'trash') {
          // Permanent delete
          files = files.filter(f => f.id !== fileId);
        } else {
          // Move to trash
          file.folder = 'trash';
          file.deleted_at = new Date().toISOString();
        }
        saveFiles();
        renderFiles();
      }
    }

    function clearTrash() {
      if (!confirm('Opravdu vysypat ko≈°? V≈°echny soubory budou trvale smaz√°ny.')) return;
      
      files = files.filter(f => f.folder !== 'trash');
      saveFiles();
      if (currentFolder === 'trash') {
        switchFolder('all');
      } else {
        renderFiles();
      }
    }

    window.closeFileModal = function() {
      document.getElementById('fileModal').classList.remove('show');
      currentFileId = null;
    };

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Drag & Drop
    const uploadArea = document.getElementById('uploadArea');
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', async (e) => {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      const fileList = Array.from(e.dataTransfer.files);
      await uploadFiles(fileList);
    });

    // Event listeners
    document.getElementById('fileSearch').addEventListener('input', renderFiles);

    // Close modals on backdrop click
    document.getElementById('previewModal').addEventListener('click', (e) => {
      if (e.target.id === 'previewModal') closePreview();
    });

    document.getElementById('fileModal').addEventListener('click', (e) => {
      if (e.target.id === 'fileModal') closeFileModal();
    });

    // Initialize
    loadFiles();
  </script>
  <div id="bottom-nav-container"></div>
  <script src="/static/bottom-nav.js"></script>
  <link rel="stylesheet" href="/static/icons.css">
  <script src="/static/app-header.js"></script>
  <script src="/static/navigation.js"></script>
  <script src="/static/toast.js"></script>
  <script src="/static/loading.js"></script>
<script src="/static/app-sidebar.js"></script>
</body>
</html>
