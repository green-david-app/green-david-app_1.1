<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zak√°zky - Green David</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-top">
            <div class="logo-area">
                <div class="logo-icon">
                    <img src="/logo.jpg" alt="Green David" onerror="this.parentElement.innerHTML='<div style=\'font-weight:700;color:var(--text-light);font-size:14px\'>GD</div>'">
                </div>
                <div class="app-title">zak√°zky</div>
            </div>
            <button class="btn btn-small" onclick="showNewJobModal()">
                <svg viewBox="0 0 24 24" style="width:20px;height:20px">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Nov√°
            </button>
        </div>
        
        <!-- Search & Filters -->
        <div style="margin-top: 16px;">
            <input type="search" id="search-input" placeholder="Hledat zak√°zky..." style="margin-bottom: 12px;">
            <div style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px;">
                <button class="btn-secondary btn-small filter-btn active" data-filter="all">V≈°e</button>
                <button class="btn-secondary btn-small filter-btn" data-filter="active">Aktivn√≠</button>
                <button class="btn-secondary btn-small filter-btn" data-filter="plan">Pl√°n</button>
                <button class="btn-secondary btn-small filter-btn" data-filter="done">Dokonƒçen√©</button>
            </div>
        </div>
    </div>
    
    <!-- Jobs List -->
    <div class="section">
        <div id="jobs-list">
            <div class="loading"><div class="spinner"></div></div>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="tab-bar">
        <div class="tab-item" onclick="location.href='/'">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                </svg>
            </div>
            <div class="tab-label">dom≈Ø</div>
        </div>
        <div class="tab-item active">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
            </div>
            <div class="tab-label">zak√°zky</div>
        </div>
        <div class="tab-item" onclick="location.href='/timesheets'">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
            </div>
            <div class="tab-label">v√Ωkazy</div>
        </div>
        <div class="tab-item" onclick="location.href='/calendar'">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
            </div>
            <div class="tab-label">kalend√°≈ô</div>
        </div>
        <div class="tab-item" onclick="location.href='/employees'">
            <div class="tab-icon">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6"></path>
                </svg>
            </div>
            <div class="tab-label">v√≠ce</div>
        </div>
    </div>
    
    <!-- New Job Modal -->
    <div id="new-job-modal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Nov√° zak√°zka</div>
                <button class="modal-close" onclick="closeNewJobModal()">
                    <svg viewBox="0 0 24 24" style="width:20px;height:20px">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="new-job-form">
                    <div class="input-group">
                        <label class="input-label">N√°zev zak√°zky *</label>
                        <input type="text" name="title" required placeholder="Zahrada Nov√°k">
                    </div>
                    <div class="input-group">
                        <label class="input-label">M√≠sto</label>
                        <input type="text" name="city" placeholder="Praha">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Datum zah√°jen√≠</label>
                        <input type="date" name="date">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Status</label>
                        <select name="status">
                            <option value="Pl√°n">Pl√°n</option>
                            <option value="Aktivn√≠">Aktivn√≠</option>
                            <option value="Dokonƒçeno">Dokonƒçeno</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Pozn√°mka</label>
                        <textarea name="notes" placeholder="Dal≈°√≠ informace..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeNewJobModal()">Zru≈°it</button>
                <button class="btn" onclick="submitNewJob()">Vytvo≈ôit</button>
            </div>
        </div>
    </div>
    
    <script>
        // API Helper
        async function api(path, opts = {}) {
            const res = await fetch(path, {
                credentials: 'same-origin',
                headers: { 'Content-Type': 'application/json' },
                ...opts
            });
            if (!res.ok) throw new Error(res.statusText);
            return await res.json();
        }
        
        let allJobs = [];
        let currentFilter = 'all';
        
        // Load jobs
        async function loadJobs() {
            try {
                const data = await api('/api/jobs');
                allJobs = data.jobs || [];
                renderJobs();
            } catch (error) {
                console.error('Error loading jobs:', error);
                document.getElementById('jobs-list').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <div class="empty-title">Chyba p≈ôi naƒç√≠t√°n√≠</div>
                        <div class="empty-text">${error.message}</div>
                    </div>
                `;
            }
        }
        
        // Render jobs
        function renderJobs() {
            const container = document.getElementById('jobs-list');
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            let filtered = allJobs;
            
            // Filter by status
            if (currentFilter !== 'all') {
                const statusMap = {
                    'active': 'aktivn√≠',
                    'plan': 'pl√°n',
                    'done': 'dokonƒçeno'
                };
                filtered = filtered.filter(job => 
                    (job.status || '').toLowerCase().includes(statusMap[currentFilter])
                );
            }
            
            // Filter by search
            if (searchTerm) {
                filtered = filtered.filter(job => 
                    (job.title || '').toLowerCase().includes(searchTerm) ||
                    (job.name || '').toLowerCase().includes(searchTerm) ||
                    (job.city || '').toLowerCase().includes(searchTerm)
                );
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <div class="empty-title">≈Ω√°dn√© zak√°zky</div>
                        <div class="empty-text">
                            ${searchTerm ? 'Zkuste jin√© vyhled√°v√°n√≠' : 'Vytvo≈ôte prvn√≠ zak√°zku'}
                        </div>
                    </div>
                `;
                return;
            }
            
            const html = filtered.map(job => {
                const status = job.status || 'Pl√°n';
                let badgeClass = 'badge-plan';
                if (status.toLowerCase().includes('aktivn√≠')) badgeClass = 'badge-active';
                if (status.toLowerCase().includes('dokonƒçeno')) badgeClass = 'badge-done';
                
                return `
                    <div class="card list-card" onclick="viewJob(${job.id})">
                        <div class="card-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                        </div>
                        <div class="card-content">
                            <div class="card-title">${job.title || job.name || 'Bez n√°zvu'}</div>
                            <div class="card-subtitle">${job.city || '-'} ‚Ä¢ ${job.date || '-'}</div>
                        </div>
                        <div class="card-badge ${badgeClass}">${status}</div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }
        
        // Filter buttons
        document.addEventListener('DOMContentLoaded', () => {
            // Load jobs
            loadJobs();
            
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderJobs();
                });
            });
            
            // Search
            document.getElementById('search-input').addEventListener('input', renderJobs);
        });
        
        // View job detail
        function viewJob(id) {
            location.href = `/jobs/${id}`;
        }
        
        // Modal functions
        function showNewJobModal() {
            document.getElementById('new-job-modal').style.display = 'flex';
        }
        
        function closeNewJobModal() {
            document.getElementById('new-job-modal').style.display = 'none';
            document.getElementById('new-job-form').reset();
        }
        
        async function submitNewJob() {
            const form = document.getElementById('new-job-form');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            try {
                await api('/api/jobs', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                closeNewJobModal();
                loadJobs();
            } catch (error) {
                alert('Chyba: ' + error.message);
            }
        }
    </script>
</body>
</html>
