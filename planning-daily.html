<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dnes | Green David</title>
    <link rel="stylesheet" href="/static/style.css"/>
    <link rel="stylesheet" href="/static/css/app.css"/>
    <link rel="stylesheet" href="/static/css/glass-design.css"/>
    <script src="/app-settings.js"></script>
    <style>
        :root {
            /* Základní */
            --bg-primary: #0a0e11;
            --bg-card: rgba(21, 26, 30, 0.7);
            --bg-elevated: rgba(26, 32, 39, 0.8);
            --border-primary: rgba(255, 255, 255, 0.06);
            --border-glow: rgba(176, 251, 165, 0.2);
            
            /* Text */
            --text-primary: #e8eef2;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-tertiary: rgba(255, 255, 255, 0.4);
            
            /* Accent - mint */
            --mint: #b0fba5;
            --mint-dim: rgba(176, 251, 165, 0.12);
            --mint-glow: rgba(176, 251, 165, 0.15);
            
            /* Pastelové barvy pro typy úkolů */
            --pastel-green: rgba(134, 239, 172, 0.15);
            --pastel-green-text: #86efac;
            --pastel-orange: rgba(253, 186, 116, 0.15);
            --pastel-orange-text: #fdba74;
            --pastel-purple: rgba(196, 181, 253, 0.15);
            --pastel-purple-text: #c4b5fd;
            --pastel-blue: rgba(147, 197, 253, 0.15);
            --pastel-blue-text: #93c5fd;
            --pastel-pink: rgba(249, 168, 212, 0.15);
            --pastel-pink-text: #f9a8d4;
            --pastel-yellow: rgba(253, 224, 71, 0.12);
            --pastel-yellow-text: #fde047;
            --pastel-red: rgba(252, 165, 165, 0.15);
            --pastel-red-text: #fca5a5;
            
            /* Glass efekt */
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-blur: 12px;
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            margin: 0;
            padding-top: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        /* Header styling */
        #app-header {
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        /* Combined navigation - positioned below header */
        #planning-nav-tabs {
            position: sticky;
            top: 64px; /* Fallback if CSS variable not set */
            top: var(--app-header-h, 64px);
            z-index: 999;
            background: rgba(26, 26, 46, 0.98);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            margin-top: 16px; /* Odstup od headeru */
            margin-bottom: 0;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Ensure body doesn't have padding that would interfere */
        body {
            padding-top: 0 !important;
            margin: 0;
        }
        
        /* Main container - must start below header + navigation tabs */
        .daily-container {
            padding: 20px;
            padding-bottom: 100px;
            padding-top: 20px;
            max-width: 1400px;
            margin: 0 auto;
            margin-top: 136px; /* Default: 64px header + 16px spacing + 56px nav tabs - will be updated by JS */
            /* Ensure content starts below sticky navigation */
            position: relative;
            z-index: 1;
        }
        
        /* Combined navigation - planning tabs + date nav */
        .combined-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            padding: 12px 24px;
            flex-wrap: wrap;
        }
        
        .combined-nav-left {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .combined-nav-right {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        /* Date nav buttons */
        .date-nav button {
            padding: 8px 14px;
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .date-nav button:hover {
            background: var(--mint-dim);
            border-color: var(--mint);
        }
        
        .date-nav .current-date {
            padding: 8px 16px;
            font-size: 15px;
            font-weight: 700;
            white-space: nowrap;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .combined-nav {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            .combined-nav-left,
            .combined-nav-right {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .combined-nav-right {
                width: 100%;
            }
        }
        
        /* Summary cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--mint);
        }
        
        .summary-card .icon {
            font-size: 24px;
            margin-bottom: 12px;
        }
        
        .summary-card .label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .summary-card .value {
            font-size: 32px;
            font-weight: 700;
        }
        
        /* Weather card */
        .weather-card {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            border-radius: 16px;
            padding: 24px;
            color: white;
            margin-bottom: 24px;
        }
        
        .weather-main {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 16px;
        }
        
        .weather-icon {
            font-size: 48px;
        }
        
        .weather-temp {
            font-size: 48px;
            font-weight: 700;
        }
        
        .weather-desc {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            font-size: 14px;
        }
        
        .weather-detail {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .outdoor-warning {
            background: rgba(255,255,255,0.15);
            border-radius: 8px;
            padding: 12px;
            margin-top: 16px;
            font-size: 14px;
            font-weight: 600;
        }
        
        /* Sections */
        .section {
            margin-bottom: 32px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title svg {
            width: 24px;
            height: 24px;
        }
        
        /* Cards */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }
        
        .item-card {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-color: var(--mint);
        }
        
        .item-card .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .item-card .card-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--text-primary);
        }
        
        .item-card .card-meta {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .badge.status-pending { background: rgba(96, 165, 250, 0.15); color: #60a5fa; }
        .badge.status-progress { background: var(--mint-dim); color: var(--mint); }
        .badge.status-done { background: rgba(107, 117, 128, 0.15); color: #9ca8b3; }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-tertiary);
        }
        
        /* === GLASS CARD MIXIN === */
        .glass-card {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.05) 0%,
                rgba(255, 255, 255, 0.02) 100%
            );
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: 
                0 4px 24px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .glass-card:hover {
            border-color: var(--border-glow);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                0 0 0 1px var(--border-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }
        
        /* === COLLAPSIBLE SECTIONS WITH GLASS === */
        .section-collapsible {
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .section-collapsible.glass-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .section-header-collapsible {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            cursor: pointer;
            user-select: none;
            background: linear-gradient(90deg, rgba(176, 251, 165, 0.05) 0%, transparent 60%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            transition: all 0.3s ease;
        }
        
        .section-header-collapsible:hover {
            background: linear-gradient(90deg, rgba(176, 251, 165, 0.08) 0%, transparent 60%);
        }
        
        .section-title-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--mint-dim);
            border-radius: 10px;
            color: var(--mint);
        }
        
        .section-icon svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            fill: none;
            stroke-width: 1.5;
        }
        
        .section-title-text {
            font-weight: 600;
            font-size: 15px;
            letter-spacing: 0.01em;
            color: var(--text-primary);
        }
        
        .section-badge {
            background: linear-gradient(135deg, var(--mint) 0%, #7dd87a 100%);
            color: #0a0e11;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(176, 251, 165, 0.3);
        }
        
        .section-toggle {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }
        
        .section-toggle svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }
        
        .section-collapsible:not(.collapsed) .section-toggle {
            background: var(--mint-dim);
            color: var(--mint);
        }
        
        .section-collapsible.collapsed .section-toggle {
            transform: rotate(-90deg);
        }
        
        .section-content {
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .section-collapsible.collapsed .section-content {
            max-height: 0;
            padding: 0 20px;
            opacity: 0;
            overflow: hidden;
        }
        
        /* === STATS GRID WITH GLASS === */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        @media (max-width: 900px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        .stat-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px 18px;
            background: linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card:hover {
            border-color: var(--border-glow);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }
        
        .stat-icon {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            flex-shrink: 0;
        }
        
        .stat-icon svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            fill: none;
            stroke-width: 1.5;
        }
        
        .stat-icon-tasks {
            background: var(--pastel-green);
            color: var(--pastel-green-text);
        }
        
        .stat-icon-people {
            background: var(--pastel-blue);
            color: var(--pastel-blue-text);
        }
        
        .stat-icon-jobs {
            background: var(--pastel-purple);
            color: var(--pastel-purple-text);
        }
        
        .stat-icon-hours {
            background: var(--pastel-orange);
            color: var(--pastel-orange-text);
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-value {
            font-size: 26px;
            font-weight: 700;
            line-height: 1;
            background: linear-gradient(135deg, var(--text-primary) 0%, rgba(255,255,255,0.8) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* === WEATHER BAR WITH GRADIENT === */
        .weather-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 50%, #1e40af 100%);
            border-radius: 14px;
            color: white;
            box-shadow: 
                0 4px 20px rgba(37, 99, 235, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .weather-main {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        
        .weather-icon-wrap {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: white;
        }
        
        .weather-icon-wrap svg {
            width: 32px;
            height: 32px;
            fill: currentColor;
        }
        
        .weather-temp {
            font-size: 32px;
            font-weight: 700;
        }
        
        .weather-desc {
            font-size: 14px;
            opacity: 0.85;
        }
        
        .weather-details {
            display: flex;
            gap: 20px;
        }
        
        .weather-detail {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .weather-detail svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }
        
        /* === TASK CARDS - MIKRO MISE WITH GLASS === */
        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .task-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            margin-bottom: 0;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .task-card:hover {
            border-color: var(--border-glow);
            transform: translateX(4px);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.2),
                -4px 0 0 var(--mint);
        }
        
        .task-type-icon {
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }
        
        .task-card:hover .task-type-icon {
            transform: scale(1.05);
        }
        
        .task-type-icon svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        .task-type-planting,
        .task-type-work {
            background: linear-gradient(135deg, var(--pastel-green) 0%, rgba(134, 239, 172, 0.25) 100%);
            color: var(--pastel-green-text);
        }
        
        .task-type-repair {
            background: linear-gradient(135deg, var(--pastel-orange) 0%, rgba(253, 186, 116, 0.25) 100%);
            color: var(--pastel-orange-text);
        }
        
        .task-type-maintenance {
            background: linear-gradient(135deg, var(--pastel-purple) 0%, rgba(196, 181, 253, 0.25) 100%);
            color: var(--pastel-purple-text);
        }
        
        .task-type-transport {
            background: linear-gradient(135deg, var(--pastel-blue) 0%, rgba(147, 197, 253, 0.25) 100%);
            color: var(--pastel-blue-text);
        }
        
        .task-type-admin {
            background: linear-gradient(135deg, var(--pastel-pink) 0%, rgba(249, 168, 212, 0.25) 100%);
            color: var(--pastel-pink-text);
        }
        
        .task-content {
            flex: 1;
            min-width: 0;
        }
        
        .task-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 5px;
        }
        
        .task-meta {
            display: flex;
            gap: 14px;
        }
        
        .task-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .task-meta-item svg {
            width: 12px;
            height: 12px;
            fill: currentColor;
            opacity: 0.6;
        }
        
        .task-time {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.05);
            padding: 6px 10px;
            border-radius: 8px;
            white-space: nowrap;
        }
        
        .task-indicators {
            display: flex;
            gap: 6px;
        }
        
        .task-indicator {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: transform 0.2s ease;
        }
        
        .task-indicator:hover {
            transform: scale(1.1);
        }
        
        .task-indicator svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }
        
        .indicator-material {
            background: var(--pastel-orange);
            color: var(--pastel-orange-text);
        }
        
        .indicator-time {
            background: var(--pastel-red);
            color: var(--pastel-red-text);
        }
        
        .indicator-dependency {
            background: var(--pastel-blue);
            color: var(--pastel-blue-text);
        }
        
        .indicator-risk {
            background: var(--pastel-yellow);
            color: var(--pastel-yellow-text);
        }
        
        .task-arrow {
            color: var(--text-tertiary);
            opacity: 0;
            transition: all 0.2s ease;
        }
        
        .task-card:hover .task-arrow {
            opacity: 1;
            transform: translateX(4px);
        }
        
        .task-arrow svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }
        
        /* === ALERTS GRID WITH GLASS === */
        .alerts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
        }
        
        .alert-box {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .alert-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .alert-error {
            border-left: 3px solid #f87171;
        }
        
        .alert-error .alert-icon-wrap {
            background: var(--pastel-red);
            color: var(--pastel-red-text);
        }
        
        .alert-warning {
            border-left: 3px solid #fbbf24;
        }
        
        .alert-warning .alert-icon-wrap {
            background: var(--pastel-yellow);
            color: var(--pastel-yellow-text);
        }
        
        .alert-info {
            border-left: 3px solid #60a5fa;
        }
        
        .alert-info .alert-icon-wrap {
            background: var(--pastel-blue);
            color: var(--pastel-blue-text);
        }
        
        .alert-icon-wrap {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            flex-shrink: 0;
        }
        
        .alert-icon-wrap svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-count {
            font-size: 22px;
            font-weight: 700;
            line-height: 1;
            color: var(--text-primary);
        }
        
        .alert-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        /* === WORKERS GRID WITH GLASS === */
        .workers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 10px;
        }
        
        .worker-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .worker-card:hover {
            border-color: var(--border-glow);
        }
        
        .worker-avatar {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--pastel-blue) 0%, rgba(147, 197, 253, 0.25) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--pastel-blue-text);
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .worker-info {
            flex: 1;
            margin-left: 12px;
        }
        
        .worker-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .worker-job,
        .worker-location {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .worker-hours {
            font-size: 18px;
            font-weight: 700;
            color: var(--mint);
        }
        
        /* === JOBS GRID WITH GLASS === */
        .jobs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 10px;
        }
        
        .job-card {
            padding: 16px;
            background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .job-card:hover {
            border-color: var(--border-glow);
            transform: translateY(-2px);
        }
        
        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .job-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .job-code {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }
        
        .job-badge {
            font-size: 10px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
            background: var(--mint-dim);
            color: var(--mint);
        }
        
        .job-progress {
            margin-top: 12px;
        }
        
        .job-progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .job-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--mint) 0%, #7dd87a 100%);
            border-radius: 2px;
            transition: width 0.5s ease;
            box-shadow: 0 0 8px rgba(176, 251, 165, 0.4);
        }
        
        .job-progress-text {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 6px;
            text-align: right;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .alerts-grid {
                grid-template-columns: 1fr;
            }
            
            .weather-bar {
                flex-direction: column;
                gap: 12px;
            }
            
            .weather-details {
                flex-wrap: wrap;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Unified Header -->
    <div id="app-header"></div>
    
    <!-- Combined Navigation: Planning Tabs + Date Navigation -->
    <div id="planning-nav-tabs" class="combined-nav">
        <!-- Left side: Planning tabs -->
        <div class="combined-nav-left">
            <a href="/planning/daily" style="padding: 8px 16px; background: var(--mint); color: #0a0e11; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 14px; transition: all 0.2s;">Dnes</a>
            <a href="/planning/timeline" style="padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: var(--text-primary); border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 14px; transition: all 0.2s;">Timeline</a>
            <a href="/planning/week" style="padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: var(--text-primary); border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 14px; transition: all 0.2s;">Týden</a>
            <a href="/planning/costs" style="padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: var(--text-primary); border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 14px; transition: all 0.2s;">Náklady</a>
        </div>
        
        <!-- Right side: Date navigation -->
        <div class="combined-nav-right date-nav">
            <button onclick="changeDate(-1)">← Včera</button>
            <button onclick="changeDate(0)" style="background: var(--mint); color: #0a0e11;">Dnes</button>
            <div class="current-date" id="currentDateDisplay">8. ledna 2026</div>
            <button onclick="changeDate(1)">Zítra →</button>
        </div>
    </div>

    <div class="daily-container">
        <!-- 1. DNEŠNÍ PŘEHLED -->
        <div class="section-collapsible glass-card" data-section="overview">
            <div class="section-header-collapsible" onclick="toggleSection(this)">
                <div class="section-title-row">
                    <div class="section-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                    </div>
                    <span class="section-title-text">Dnešní přehled</span>
                </div>
                <div class="section-toggle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </div>
            </div>
            <div class="section-content">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon stat-icon-tasks">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M9 11l3 3L22 4"/>
                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="tasksCount">0</div>
                            <div class="stat-label">Úkolů</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon stat-icon-people">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                                <path d="M16 3.13a4 4 0 010 7.75"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="peopleCount">0</div>
                            <div class="stat-label">Lidí v práci</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon stat-icon-jobs">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="2" y="7" width="20" height="14" rx="2"/>
                                <path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="jobsCount">0</div>
                            <div class="stat-label">Aktivních zakázek</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon stat-icon-hours">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="hoursCount">0h</div>
                            <div class="stat-label">Odpracováno</div>
                        </div>
                    </div>
                </div>
                
                <!-- Weather Bar -->
                <div class="weather-bar" id="weatherBar" style="display:none;">
                    <div class="weather-main">
                        <div class="weather-icon-wrap" id="weatherIconWrap">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/>
                            </svg>
                        </div>
                        <div>
                            <div class="weather-temp" id="weatherTempBar">--°C</div>
                            <div class="weather-desc" id="weatherDescBar">Načítám počasí...</div>
                        </div>
                    </div>
                    <div class="weather-details" id="weatherDetailsBar"></div>
                </div>
            </div>
        </div>

        <!-- 2. MOJE ÚKOLY NA DNES -->
        <div class="section-collapsible glass-card" data-section="tasks">
            <div class="section-header-collapsible" onclick="toggleSection(this)">
                <div class="section-title-row">
                    <div class="section-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M9 11l3 3L22 4"/>
                            <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
                        </svg>
                    </div>
                    <span class="section-title-text">Moje úkoly na dnes</span>
                    <span class="section-badge" id="tasksBadge">0</span>
                </div>
                <div class="section-toggle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </div>
            </div>
            <div class="section-content">
                <div class="tasks-list" id="tasksList"></div>
            </div>
        </div>

        <!-- 3. VYŽADUJE POZORNOST -->
        <div class="section-collapsible glass-card" data-section="alerts">
            <div class="section-header-collapsible" onclick="toggleSection(this)">
                <div class="section-title-row">
                    <div class="section-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                    </div>
                    <span class="section-title-text">Vyžaduje pozornost</span>
                    <span class="section-badge" id="alertsBadge">0</span>
                </div>
                <div class="section-toggle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </div>
            </div>
            <div class="section-content">
                <div class="alerts-grid" id="alertsGrid"></div>
            </div>
        </div>

        <!-- 4. KDO KDE PRACUJE -->
        <div class="section-collapsible glass-card" data-section="workers">
            <div class="section-header-collapsible" onclick="toggleSection(this)">
                <div class="section-title-row">
                    <div class="section-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                            <path d="M16 3.13a4 4 0 010 7.75"/>
                        </svg>
                    </div>
                    <span class="section-title-text">Kdo kde pracuje</span>
                    <span class="section-badge" id="workersBadge">0</span>
                </div>
                <div class="section-toggle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </div>
            </div>
            <div class="section-content">
                <div class="workers-grid" id="timesheetsList"></div>
            </div>
        </div>

        <!-- 5. AKTIVNÍ ZAKÁZKY -->
        <div class="section-collapsible glass-card" data-section="jobs">
            <div class="section-header-collapsible" onclick="toggleSection(this)">
                <div class="section-title-row">
                    <div class="section-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="2" y="7" width="20" height="14" rx="2"/>
                            <path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/>
                        </svg>
                    </div>
                    <span class="section-title-text">Aktivní zakázky</span>
                    <span class="section-badge" id="jobsBadge">0</span>
                </div>
                <div class="section-toggle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </div>
            </div>
            <div class="section-content">
                <div class="jobs-grid" id="jobsList"></div>
            </div>
        </div>
    </div>

    <script>
        // Task type icons (SVG)
        const taskTypeIcons = {
            work: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 22c4.97 0 9-4.03 9-9-4.97 0-9 4.03-9 9zM3 13c0 4.97 4.03 9 9 9 0-4.97-4.03-9-9-9zm9-11C9.5 2.12 8.12 3.5 8.12 5.5c0 1 .59 1.85 1.43 2.25-.84.4-1.43 1.25-1.43 2.25 0 1.38 1.12 2.5 2.5 2.5.53 0 1.01-.16 1.42-.44l-.02.19c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5l-.02-.19c.4.28.89.44 1.42.44 1.38 0 2.5-1.12 2.5-2.5 0-1-.59-1.85-1.43-2.25.84-.4 1.43-1.25 1.43-2.25 0-1.38-1.12-2.5-2.5-2.5-.53 0-1.01.16-1.42.44l.02-.19C14.5 2.12 13.38 1 12 1z"/></svg>',
            repair: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>',
            maintenance: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41L9.25 5.35C8.66 5.59 8.12 5.92 7.63 6.29L5.24 5.33c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.22-.07.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.57 3.6-3.6 3.6z"/></svg>',
            transport: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>',
            admin: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>'
        };
        
        // Collapsible sections
        function toggleSection(header) {
            const section = header.closest('.section-collapsible');
            section.classList.toggle('collapsed');
            
            // Uložit stav do localStorage
            const sectionId = section.dataset.section;
            const collapsed = section.classList.contains('collapsed');
            localStorage.setItem(`section_${sectionId}`, collapsed ? 'collapsed' : 'expanded');
        }
        
        // Obnovit stav sekcí při načtení
        function restoreSectionStates() {
            document.querySelectorAll('.section-collapsible').forEach(section => {
                const sectionId = section.dataset.section;
                const state = localStorage.getItem(`section_${sectionId}`);
                if (state === 'collapsed') {
                    section.classList.add('collapsed');
                }
            });
        }
        
        let currentDate = new Date();

        function changeDate(offset) {
            if (offset === 0) {
                currentDate = new Date();
            } else {
                currentDate.setDate(currentDate.getDate() + offset);
            }
            loadDailyData();
        }

        async function loadDailyData() {
            const dateStr = currentDate.toISOString().split('T')[0];
            document.getElementById('currentDateDisplay').textContent = 
                currentDate.toLocaleDateString('cs-CZ', {day: 'numeric', month: 'long', year: 'numeric'});

            try {
                const [dailyResp, notifResp, suggestResp] = await Promise.all([
                    fetch(`/api/planning/daily/${dateStr}`),
                    fetch('/api/planning/notifications'),
                    fetch('/api/planning/suggestions')
                ]);
                
                const dailyData = await dailyResp.json();
                const notifData = await notifResp.json();
                const suggestData = await suggestResp.json();

                if (dailyData.success) {
                    renderData(dailyData);
                }
                
                // Render alerts
                renderAlerts(notifData, suggestData);
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        function renderAlerts(notifications, suggestions) {
            const alertGroups = {
                overdue: { 
                    count: 0, 
                    type: 'error', 
                    icon: '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>', 
                    label: 'Po termínu' 
                },
                unassigned: { 
                    count: 0, 
                    type: 'warning', 
                    icon: '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>', 
                    label: 'Bez přiřazení' 
                },
                upcoming: { 
                    count: 0, 
                    type: 'info', 
                    icon: '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>', 
                    label: 'Blíží se deadline' 
                },
                other: { 
                    count: 0, 
                    type: 'info', 
                    icon: '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>', 
                    label: 'Ostatní' 
                }
            };
            
            // Process notifications
            if (notifications.success && notifications.notifications) {
                notifications.notifications.forEach(n => {
                    if (n.title && n.title.toLowerCase().includes('opožděn')) {
                        alertGroups.overdue.count++;
                    } else if (n.title && n.title.toLowerCase().includes('bez přiřazení')) {
                        alertGroups.unassigned.count++;
                    } else if (n.title && n.title.toLowerCase().includes('deadline')) {
                        alertGroups.upcoming.count++;
                    } else {
                        alertGroups.other.count++;
                    }
                });
            }
            
            // Process suggestions
            if (suggestions.success && suggestions.suggestions) {
                suggestions.suggestions.forEach(s => {
                    if (s.title && s.title.toLowerCase().includes('deadline')) {
                        alertGroups.upcoming.count++;
                    } else {
                        alertGroups.other.count++;
                    }
                });
            }
            
            // Render alert boxes
            let html = '';
            let totalAlerts = 0;
            
            Object.entries(alertGroups).forEach(([key, group]) => {
                if (group.count > 0) {
                    totalAlerts += group.count;
                    const alertClass = `alert-${group.type}`;
                    html += `<div class="alert-box ${alertClass}" onclick="window.location.href='/tasks.html'">`;
                    html += `<div class="alert-icon-wrap">${group.icon}</div>`;
                    html += `<div class="alert-content">`;
                    html += `<div class="alert-count">${group.count}</div>`;
                    html += `<div class="alert-label">${group.label}</div>`;
                    html += `</div></div>`;
                }
            });
            
            if (totalAlerts > 0) {
                document.getElementById('alertsGrid').innerHTML = html;
                document.getElementById('alertsBadge').textContent = totalAlerts;
            } else {
                document.getElementById('alertsGrid').innerHTML = '<div class="empty-state">Vše v pořádku!</div>';
                document.getElementById('alertsBadge').textContent = '0';
            }
        }

        function renderData(data) {
            // Summary stats
            const tasksCount = data.summary?.tasks_count || 0;
            const peopleCount = data.summary?.employees_working || 0;
            const jobsCount = data.active_jobs?.length || 0;
            const hoursCount = data.summary?.total_hours || 0;
            
            document.getElementById('tasksCount').textContent = tasksCount;
            document.getElementById('peopleCount').textContent = peopleCount;
            document.getElementById('jobsCount').textContent = jobsCount;
            document.getElementById('hoursCount').textContent = hoursCount + 'h';
            
            // Update badges
            document.getElementById('tasksBadge').textContent = tasksCount;
            document.getElementById('workersBadge').textContent = peopleCount;
            document.getElementById('jobsBadge').textContent = jobsCount;

            // Weather Bar
            if (data.weather) {
                const w = data.weather;
                const weatherBar = document.getElementById('weatherBar');
                weatherBar.style.display = 'flex';
                document.getElementById('weatherTempBar').textContent = `${w.temp}°C`;
                document.getElementById('weatherDescBar').textContent = w.description || '';
                
                // Weather icon SVG
                const weatherIconSvg = getWeatherIconSVG(w.icon);
                document.getElementById('weatherIconWrap').innerHTML = weatherIconSvg;
                
                // Weather details with SVG icons
                let detailsHtml = '';
                detailsHtml += `<div class="weather-detail">`;
                detailsHtml += `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.59 4.59A2 2 0 1111 8H2m10.59 11.41A2 2 0 1014 16H2m15.73-8.27A2.5 2.5 0 1119.5 12H2"/></svg>`;
                detailsHtml += `<span>${w.wind_speed || 0} m/s</span>`;
                detailsHtml += `</div>`;
                detailsHtml += `<div class="weather-detail">`;
                detailsHtml += `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/></svg>`;
                detailsHtml += `<span>${w.rain_probability || 0}%</span>`;
                detailsHtml += `</div>`;
                detailsHtml += `<div class="weather-detail">`;
                detailsHtml += `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 14.76V3.5a2.5 2.5 0 00-5 0v11.26a4.5 4.5 0 105 0z"/></svg>`;
                detailsHtml += `<span>${w.humidity || 0}%</span>`;
                detailsHtml += `</div>`;
                document.getElementById('weatherDetailsBar').innerHTML = detailsHtml;
            }

            // Tasks - Mikro mise design
            if (data.tasks && data.tasks.length > 0) {
                let html = '';
                data.tasks.forEach(t => {
                    // Determine task type (default to work)
                    const taskType = t.type || 'work';
                    const typeClass = `task-type-${taskType}`;
                    const typeIcon = taskTypeIcons[taskType] || taskTypeIcons.work;
                    
                    // Build indicators with SVG icons
                    let indicators = '';
                    if (t.needs_material) {
                        indicators += `<div class="task-indicator indicator-material" title="Vyžaduje materiál">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 013 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9z"/></svg>
                        </div>`;
                    }
                    if (t.is_overdue) {
                        indicators += `<div class="task-indicator indicator-time" title="Zpožděno">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        </div>`;
                    }
                    if (t.has_dependency) {
                        indicators += `<div class="task-indicator indicator-dependency" title="Má závislost">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5zm-6 8H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-2zm-3-4h8v2H8z"/></svg>
                        </div>`;
                    }
                    if (t.has_risk) {
                        indicators += `<div class="task-indicator indicator-risk" title="Riziko">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                        </div>`;
                    }
                    
                    // Time window
                    const timeWindow = t.start_time && t.end_time 
                        ? `${t.start_time}-${t.end_time}` 
                        : '';
                    
                    html += `<div class="task-card" onclick="window.location.href='/tasks.html'">`;
                    html += `<div class="task-type-icon ${typeClass}">${typeIcon}</div>`;
                    html += `<div class="task-content">`;
                    html += `<div class="task-title">${t.title || 'Úkol'}</div>`;
                    html += `<div class="task-meta">`;
                    if (t.job_name) {
                        html += `<span class="task-meta-item">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                            ${t.job_name}
                        </span>`;
                    }
                    if (t.assigned_employee) {
                        html += `<span class="task-meta-item">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                            ${t.assigned_employee}
                        </span>`;
                    }
                    html += `</div></div>`;
                    if (timeWindow) html += `<div class="task-time">${timeWindow}</div>`;
                    if (indicators) html += `<div class="task-indicators">${indicators}</div>`;
                    html += `<div class="task-arrow">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </div>`;
                    html += `</div>`;
                });
                document.getElementById('tasksList').innerHTML = html;
            } else {
                document.getElementById('tasksList').innerHTML = '<div class="empty-state">Žádné úkoly na dnes</div>';
            }

            // Workers - Compact cards with avatar
            if (data.timesheets && data.timesheets.length > 0) {
                let html = '';
                data.timesheets.forEach(ts => {
                    const initials = (ts.employee_name || 'N').split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                    html += `<div class="worker-card">`;
                    html += `<div class="worker-avatar">${initials}</div>`;
                    html += `<div class="worker-info">`;
                    html += `<div class="worker-name">${ts.employee_name || 'Neznámý'}</div>`;
                    html += `<div class="worker-job">${ts.job_name || 'Zakázka'}</div>`;
                    html += `</div>`;
                    html += `<div class="worker-hours">${ts.hours || 0}h</div>`;
                    html += `</div>`;
                });
                document.getElementById('timesheetsList').innerHTML = html;
            } else {
                document.getElementById('timesheetsList').innerHTML = '<div class="empty-state">Žádné zalogované hodiny</div>';
            }

            // Jobs - With progress bar
            if (data.active_jobs && data.active_jobs.length > 0) {
                let html = '';
                data.active_jobs.forEach(j => {
                    html += `<div class="job-card" onclick="window.location.href='/job-detail.html?id=${j.id}'">`;
                    html += `<div class="job-header">`;
                    html += `<div class="job-name">${j.name || 'Zakázka'}</div>`;
                    html += `<span class="badge status-progress">${j.status || 'Plán'}</span>`;
                    html += `</div>`;
                    if (j.code) html += `<div class="job-code">Kód: ${j.code}</div>`;
                    if (j.progress !== undefined) {
                        html += `<div class="job-progress-bar">`;
                        html += `<div class="job-progress-fill" style="width: ${j.progress}%"></div>`;
                        html += `</div>`;
                    }
                    html += `</div>`;
                });
                document.getElementById('jobsList').innerHTML = html;
            } else {
                document.getElementById('jobsList').innerHTML = '<div class="empty-state">Žádné aktivní zakázky</div>';
            }
        }

        function getWeatherIcon(code) {
            const icons = {
                '01d': '☀️', '01n': '🌙', '02d': '🌤️', '02n': '☁️',
                '03d': '☁️', '03n': '☁️', '04d': '☁️', '04n': '☁️',
                '09d': '🌧️', '09n': '🌧️', '10d': '🌦️', '10n': '🌧️',
                '11d': '⛈️', '11n': '⛈️', '13d': '❄️', '13n': '❄️',
                '50d': '🌫️', '50n': '🌫️'
            };
            return icons[code] || '🌤️';
        }
        
        function getWeatherIconSVG(code) {
            const icons = {
                '01d': '<svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="5"/><path d="M12 1v3m0 16v3M5.64 5.64l2.12 2.12m9.9 9.9l2.12 2.12M1 12h3m16 0h3M5.64 18.36l2.12-2.12m9.9-9.9l2.12-2.12"/></svg>',
                '01n': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',
                '02d': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM12 6c2.76 0 5 2.24 5 5s-2.24 5-5 5-5-2.24-5-5 2.24-5 5-5z"/></svg>',
                '02n': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM12 6c2.76 0 5 2.24 5 5s-2.24 5-5 5-5-2.24-5-5 2.24-5 5-5z"/><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',
                '03d': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>',
                '03n': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>',
                '04d': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>',
                '04n': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>',
                '09d': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm13-5.95l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-1.79 12.11l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V22h-2v.45zm0-19.9h2V2h-2v.05z"/></svg>',
                '09n': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm13-5.95l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-1.79 12.11l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V22h-2v.45zm0-19.9h2V2h-2v.05z"/></svg>',
                '10d': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm13-5.95l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-1.79 12.11l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V22h-2v.45zm0-19.9h2V2h-2v.05z"/></svg>',
                '10n': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm13-5.95l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-1.79 12.11l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V22h-2v.45zm0-19.9h2V2h-2v.05z"/></svg>',
                '11d': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M4.5 9.03a8.5 8.5 0 0 1 7.5-.5V7H12v1.53a8.5 8.5 0 0 1 7.5.5L17 12l2.5 2.97a8.5 8.5 0 0 1-7.5.5V17h-1v-1.53a8.5 8.5 0 0 1-7.5-.5L7 12l-2.5-2.97z"/></svg>',
                '11n': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M4.5 9.03a8.5 8.5 0 0 1 7.5-.5V7H12v1.53a8.5 8.5 0 0 1 7.5.5L17 12l2.5 2.97a8.5 8.5 0 0 1-7.5.5V17h-1v-1.53a8.5 8.5 0 0 1-7.5-.5L7 12l-2.5-2.97z"/></svg>',
                '13d': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 18h2v-2h-2v2zm0-4h2v-2h-2v2zm-2-4v2h2v-2h-2zm-2 8h2v-2h-2v2zm-4-4h2v-2h-2v2zm0-4h2v-2h-2v2zm-4 0h2v-2H8v2zm0 4h2v-2H8v2zm0 4h2v-2H8v2zm-2-4h2v-2H6v2zm0-4h2v-2H6v2zm-2 0h2v-2H4v2zm0 4h2v-2H4v2zm0 4h18v2H2V2h2v16z"/></svg>',
                '13n': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 18h2v-2h-2v2zm0-4h2v-2h-2v2zm-2-4v2h2v-2h-2zm-2 8h2v-2h-2v2zm-4-4h2v-2h-2v2zm0-4h2v-2h-2v2zm-4 0h2v-2H8v2zm0 4h2v-2H8v2zm0 4h2v-2H8v2zm-2-4h2v-2H6v2zm0-4h2v-2H6v2zm-2 0h2v-2H4v2zm0 4h2v-2H4v2zm0 4h18v2H2V2h2v16z"/></svg>',
                '50d': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.01 6c2.61 0 4.89 1.86 5.4 4.43l.3 1.5 1.52.11c1.56.11 2.78 1.41 2.78 2.96 0 1.65-1.35 3-3 3h-13c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95C8.08 7.14 9.95 6 12.01 6m0-2C9.12 4 6.6 5.64 5.35 8.04 2.35 8.36.01 10.91.01 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.64-4.96C18.68 6.59 15.65 4 12.01 4z"/></svg>',
                '50n': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.01 6c2.61 0 4.89 1.86 5.4 4.43l.3 1.5 1.52.11c1.56.11 2.78 1.41 2.78 2.96 0 1.65-1.35 3-3 3h-13c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95C8.08 7.14 9.95 6 12.01 6m0-2C9.12 4 6.6 5.64 5.35 8.04 2.35 8.36.01 10.91.01 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.64-4.96C18.68 6.59 15.65 4 12.01 4z"/></svg>'
            };
            return icons[code] || '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>';
        }

        // Init
        loadDailyData();
        
        // Restore section states on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', restoreSectionStates);
        } else {
            restoreSectionStates();
        }
    </script>
    
    <!-- Load unified header -->
    <script src="/static/app-header.js"></script>
    <script>
        // Initialize header when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new AppHeader();
            
            // Ensure navigation tabs and content are positioned correctly after header renders
            function updateLayout() {
                const header = document.querySelector('.app-header');
                const navTabs = document.getElementById('planning-nav-tabs');
                const container = document.querySelector('.daily-container');
                
                if (header && navTabs) {
                    const headerHeight = header.offsetHeight || 64;
                    const spacing = 16; // Mezera mezi headerem a navigation tabs
                    const navTabsHeight = navTabs.offsetHeight || 56;
                    const totalHeight = headerHeight + spacing + navTabsHeight;
                    
                    // Set CSS variable for header height
                    document.documentElement.style.setProperty('--app-header-h', headerHeight + 'px');
                    
                    // Update navigation tabs top position with spacing
                    navTabs.style.top = (headerHeight + spacing) + 'px';
                    
                    // Update container margin to account for header, spacing, and nav tabs
                    if (container) {
                        container.style.marginTop = totalHeight + 'px';
                    }
                }
            }
            
            // Update immediately and after delays to ensure header is rendered
            setTimeout(updateLayout, 100);
            setTimeout(updateLayout, 300);
            setTimeout(updateLayout, 500);
            
            // Also update on window resize
            window.addEventListener('resize', updateLayout);
        });
    </script>
</body>
</html>
